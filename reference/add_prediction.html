<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Add predictions and confidence interval to data using either
a model object or model coefficients"><title>Add predictions and confidence interval to data using either
a model object or model coefficients — add_prediction • DImodelsVis</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add predictions and confidence interval to data using either
a model object or model coefficients — add_prediction"><meta property="og:description" content="Add predictions and confidence interval to data using either
a model object or model coefficients"><meta property="og:image" content="https://rishvish.github.io/DImodelsVis/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DImodelsVis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/DImodelsVis-with-complex-models.html">Using DImodelsVis with regression models not fit using the DImodels package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add predictions and confidence interval to data using either
a model object or model coefficients</h1>
      
      <div class="d-none name"><code>add_prediction.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add predictions and confidence interval to data using either
a model object or model coefficients</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_prediction</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coefficients <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coeff_cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"confidence"</span>, <span class="st">"prediction"</span><span class="op">)</span>,</span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data-frame containing appropriate values for all the terms
in the model.</p></dd>


<dt>model</dt>
<dd><p>A regression model object which will be used to make predictions
for the observations in `data`. Will override `coefficients`
if specified.</p></dd>


<dt>coefficients</dt>
<dd><p>If a regression model is not available (or can't be fit in R),
the regression coefficients from a model fit in some other
language can be used to calculate predictions. However, the
user would have to ensure there's an appropriate one-to-one
positional mapping between the data columns and the
coefficient values. Further, they would also have to provide
a variance-covariance matrix of the coefficients in the `vcov`
parameter if they want the associated CI for the prediction or
it would not be possible to calculate confidence/prediction
intervals using this method.</p></dd>


<dt>coeff_cols</dt>
<dd><p>If `coefficients` are specified and a one-to-one positional
mapping between the data-columns and coefficient vector is
not present. A character string or numeric index can be specified
here to reorder the data columns and match the corresponding
coefficient value to the respective data column. See the
"Use model coefficients for prediction" section in examples.</p></dd>


<dt>vcov</dt>
<dd><p>If regression coefficients are specified, then the variance-covariance
matrix of the coefficients can be specified here to calculate the
associated confidence interval around each prediction. Failure to do
so would result in no confidence intervals being returned. Ensure
`coefficients` and `vcov` have the same positional mapping with the data.</p></dd>


<dt>interval</dt>
<dd><p>Type of interval to calculate:</p><dl><dt>"none" (default)</dt>
<dd><p>No interval to be calculated.</p></dd>

  <dt>"confidence"</dt>
<dd><p>Calculate a confidence interval.</p></dd>

  <dt>"prediction"</dt>
<dd><p>Calculate a prediction interval.</p></dd>


</dl></dd>


<dt>conf.level</dt>
<dd><p>The confidence level for calculating confidence/prediction
intervals. Default is 0.95.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data-frame with the following additional columns</p>
<p></p>
<dl><dt>.Pred</dt>
<dd><p>The predicted response for each observation.</p></dd>

   <dt>.Lower</dt>
<dd><p>The lower limit of the confidence/prediction interval
                 for each observation (will be same as ".Pred" if using
                 `coefficients` and `vcov` is not specified).</p></dd>

   <dt>.Upper</dt>
<dd><p>The lower limit of the confidence/prediction interval
                 for each observation (will be same as ".Pred" if using
                 `coefficients` and `vcov` is not specified).</p></dd>

 
</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DImodels</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit a model</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p1</span><span class="op">:</span><span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span><span class="op">:</span><span class="va">p4</span>, data <span class="op">=</span> <span class="va">sim1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create new data for adding predictions</span></span></span>
<span class="r-in"><span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">[</span><span class="va">sim1</span><span class="op">$</span><span class="va">block</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add predictions to data</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 10.601405</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Adding predictions to data with confidence interval</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, model <span class="op">=</span> <span class="va">mod</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response     .Pred   .Lower    .Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 10.466907 9.798148 11.135666</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 10.253858 9.585100 10.922617</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135  9.615319 8.946561 10.284078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916  8.584323 7.915564  9.253081</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374  9.795128 9.328378 10.261878</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 10.601405 9.531207 11.671603</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate prediction intervals instead</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, model <span class="op">=</span> <span class="va">mod</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response     .Pred   .Lower   .Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 10.466907 7.769709 13.16410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 10.253858 7.556661 12.95106</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135  9.615319 6.918122 12.31252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916  8.584323 5.887125 11.28152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374  9.795128 7.140794 12.44946</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 10.601405 7.777762 13.42505</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Default is a 95% interval, change to 99%</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, model <span class="op">=</span> <span class="va">mod</span>, interval <span class="op">=</span> <span class="st">"prediction"</span>,</span></span>
<span class="r-in"><span>               conf.level <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response     .Pred   .Lower   .Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 10.466907 6.874932 14.05888</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 10.253858 6.661883 13.84583</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135  9.615319 6.023344 13.20729</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916  8.584323 4.992347 12.17630</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374  9.795128 6.260235 13.33002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 10.601405 6.841037 14.36177</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">####################################################################</span></span></span>
<span class="r-in"><span><span class="co">##### Use model coefficients for prediction</span></span></span>
<span class="r-in"><span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">coefficients</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Would now have to add columns corresponding to each coefficient in the</span></span></span>
<span class="r-in"><span><span class="co"># data and ensure there is an appropriate mapping between data columns and</span></span></span>
<span class="r-in"><span><span class="co"># the coefficients.</span></span></span>
<span class="r-in"><span><span class="va">newdata</span><span class="op">$</span><span class="va">`p1:p2`</span> <span class="op">=</span> <span class="va">newdata</span><span class="op">$</span><span class="va">p1</span> <span class="op">*</span> <span class="va">newdata</span><span class="op">$</span><span class="va">p2</span></span></span>
<span class="r-in"><span><span class="va">newdata</span><span class="op">$</span><span class="va">`p3:p4`</span> <span class="op">=</span> <span class="va">newdata</span><span class="op">$</span><span class="va">p3</span> <span class="op">*</span> <span class="va">newdata</span><span class="op">$</span><span class="va">p4</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If the coefficients are named then the function will try to</span></span></span>
<span class="r-in"><span><span class="co"># perform matching between data columns and the coefficients</span></span></span>
<span class="r-in"><span><span class="co"># Notice that confidence intervals are not produced if we don't</span></span></span>
<span class="r-in"><span><span class="co"># specify a variance covariance matrix</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, coefficients <span class="op">=</span> <span class="va">coeffs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response  p1:p2  p3:p4     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 0.0700 0.0100 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 0.0700 0.0100 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135 0.0100 0.0700  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916 0.0100 0.0700  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374 0.0625 0.0625  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 0.1600 0.0100 10.601405</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># However, if the coefficients are not named</span></span></span>
<span class="r-in"><span><span class="co"># The user would have to manually specify the subset</span></span></span>
<span class="r-in"><span><span class="co"># of data columns arranged according to the coefficients</span></span></span>
<span class="r-in"><span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">subset_data</span> <span class="op">&lt;-</span> <span class="va">newdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">subset_data</span> <span class="co"># Notice now we have the exact columns in data as in coefficients</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      p1   p2   p3   p4  p1:p2  p3:p4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.70 0.10 0.10 0.10 0.0700 0.0100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.10 0.70 0.10 0.10 0.0700 0.0100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  0.10 0.10 0.70 0.10 0.0100 0.0700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 0.10 0.10 0.10 0.70 0.0100 0.0700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 0.25 0.25 0.25 0.25 0.0625 0.0625</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 0.40 0.40 0.10 0.10 0.1600 0.0100</span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">subset_data</span>, coefficients <span class="op">=</span> <span class="va">coeffs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      p1   p2   p3   p4  p1:p2  p3:p4     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.70 0.10 0.10 0.10 0.0700 0.0100 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.10 0.70 0.10 0.10 0.0700 0.0100 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  0.10 0.10 0.70 0.10 0.0100 0.0700  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 0.10 0.10 0.10 0.70 0.0100 0.0700  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 0.25 0.25 0.25 0.25 0.0625 0.0625  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 0.40 0.40 0.10 0.10 0.1600 0.0100 10.601405</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or specify a selection (either by name or index) in coeff_cols</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, coefficients <span class="op">=</span> <span class="va">coeffs</span>,</span></span>
<span class="r-in"><span>               coeff_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span>, <span class="st">"p3"</span>, <span class="st">"p4"</span>, <span class="st">"p1:p2"</span>, <span class="st">"p3:p4"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response  p1:p2  p3:p4     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 0.0700 0.0100 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 0.0700 0.0100 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135 0.0100 0.0700  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916 0.0100 0.0700  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374 0.0625 0.0625  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 0.1600 0.0100 10.601405</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, coefficients <span class="op">=</span> <span class="va">coeffs</span>,</span></span>
<span class="r-in"><span>               coeff_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response  p1:p2  p3:p4     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 0.0700 0.0100 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 0.0700 0.0100 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135 0.0100 0.0700  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916 0.0100 0.0700  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374 0.0625 0.0625  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 0.1600 0.0100 10.601405</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Adding confidence intervals when using model coefficients</span></span></span>
<span class="r-in"><span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">coefficients</span></span></span>
<span class="r-in"><span><span class="co"># We need to provide a variance-covariance matrix to calculate the CI</span></span></span>
<span class="r-in"><span><span class="co"># when using `coefficients` argument. The following warning will be given</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, coefficients <span class="op">=</span> <span class="va">coeffs</span>,</span></span>
<span class="r-in"><span>               interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`vcov` was not specified so confidence intervals cannot be calculated.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The <span style="color: #0000BB;">".Upper"</span> and <span style="color: #0000BB;">".Lower"</span> columns will contain the same value as the <span style="color: #0000BB;">".Pred"</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>   column.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response  p1:p2  p3:p4     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 0.0700 0.0100 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 0.0700 0.0100 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135 0.0100 0.0700  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916 0.0100 0.0700  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374 0.0625 0.0625  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 0.1600 0.0100 10.601405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       .Lower    .Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  10.466907 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  10.253858 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   9.615319  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  8.584323  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17  9.795128  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 10.601405 10.601405</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">vcov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, coefficients <span class="op">=</span> <span class="va">coeffs</span>,</span></span>
<span class="r-in"><span>               interval <span class="op">=</span> <span class="st">"confidence"</span>, vcov <span class="op">=</span> <span class="va">vcov_mat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response  p1:p2  p3:p4     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 0.0700 0.0100 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 0.0700 0.0100 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135 0.0100 0.0700  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916 0.0100 0.0700  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374 0.0625 0.0625  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 0.1600 0.0100 10.601405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      .Lower    .Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  9.813131 11.120684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  9.600082 10.907635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  8.961543 10.269096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 7.930546  9.238099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 9.338835 10.251422</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 9.555182 11.647627</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Currently both confidence and prediction intervals will be the same when</span></span></span>
<span class="r-in"><span><span class="co"># using this method</span></span></span>
<span class="r-in"><span><span class="fu">add_prediction</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, coefficients <span class="op">=</span> <span class="va">coeffs</span>,</span></span>
<span class="r-in"><span>               interval <span class="op">=</span> <span class="st">"prediction"</span>, vcov <span class="op">=</span> <span class="va">vcov_mat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    community block   p1   p2   p3   p4 response  p1:p2  p3:p4     .Pred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1     1 0.70 0.10 0.10 0.10   10.815 0.0700 0.0100 10.466907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2     1 0.10 0.70 0.10 0.10    6.724 0.0700 0.0100 10.253858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9          3     1 0.10 0.10 0.70 0.10   11.135 0.0100 0.0700  9.615319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         4     1 0.10 0.10 0.10 0.70    9.916 0.0100 0.0700  8.584323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         5     1 0.25 0.25 0.25 0.25   11.374 0.0625 0.0625  9.795128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21         6     1 0.40 0.40 0.10 0.10   12.492 0.1600 0.0100 10.601405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      .Lower    .Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  9.813131 11.120684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  9.600082 10.907635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  8.961543 10.269096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 7.930546  9.238099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 9.338835 10.251422</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 9.555182 11.647627</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Rishabh Vishwakarma, Caroline Brophy, Laura Byrne, Catherine Hurley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

