<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using DImodelsVis with regression models not fit using the DImodels package • DImodelsVis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using DImodelsVis with regression models not fit using the DImodels package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DImodelsVis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using DImodelsVis with regression models not fit using the DImodels package</h1>
            
      

      <div class="d-none name"><code>DImodelsVis-with-complex-models.Rmd</code></div>
    </div>

    
    
<style type="text/css">

/* Highlight box */
.highlightbox {
  background-color: #e6f0fa;   /* light blue */
  border: 2px solid #156082;   /* darker blue */
  border-radius: 6px;
  padding: 10px 14px;
  margin: 12px 0;
  box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
}


/* Note box */
.notebox {
  background-color: #f7f7f7;   /* light gray */
  border: 1px solid #999999;   /* medium gray */
  border-radius: 4px;
  padding: 8px 12px;
  margin: 10px 0;
  box-shadow: 1px 1px 4px rgba(0,0,0,0.08);
}

</style>
<p><code>DImodelsVis</code> is very convenient to use with regression
models fit using the <a href="https://cran.r-project.org/package=DImodels" class="external-link"><code>DImodels</code></a>
or <a href="https://cran.r-project.org/package=DImodelsMulti" class="external-link"><code>DImodelsMulti</code></a>
R packages. However, there may be situations when users need to work
with highly customised and complex models that are not possible to fit
using either <code>DImodels</code> or <code>DImodelsMulti</code>.
Additionally, users may also desire finer control over the visualisation
pipeline and seek to modify both, the plot appearance as well as the
underlying data. To accommodate these needs, each visualisation function
in <code>DImodelsVis</code> is paired with a separate data preparation
(suffixed by <code>_data</code>) and plotting (suffixed by
<code>_plot</code>) function. This separation provides great
flexibility, as the data preparation functions allow users to create,
modify, or extend the prepared data before visualising it, while the
plotting functions enable customisation of the plot aesthetics
independently. This document provides examples demonstrating how users
can leverage this separation to create visualisations in a modular
manner and derive insights from any regression model with compositional
predictors using <code>DImodelsVis</code>. The examples shown here are
created with a regression model fit using <code>glm</code> but the exact
same principles would apply for creating visualisations using any other
regression modelling tool kit.</p>
<div class="section level3">
<h3 id="loading-necessary-packages">Loading necessary packages<a class="anchor" aria-label="anchor" href="#loading-necessary-packages"></a>
</h3>
<p>The following R packages will be used for data processing and
generating visualisations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dimodels.com/" class="external-link">DImodels</a></span><span class="op">)</span>     <span class="co"># For loading the dataset</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rishvish.github.io/DImodelsVis/">DImodelsVis</a></span><span class="op">)</span>  <span class="co"># For creating visualisations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co"># For data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co"># For modifying visualisations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rishvish.github.io/PieGlyph/" class="external-link">PieGlyph</a></span><span class="op">)</span>     <span class="co"># Adding Pie-glyphs on figures</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>We use the <code>sim4</code> data (henceforth referred as
<code>sim4</code>) from the <a href="https://cran.r-project.org/package=DImodels" class="external-link"><code>DImodels</code></a>
R package. The <code>sim4</code> data is simulated to represent patterns
commonly observed in BEF studies. The proportions of six species
(labelled p1 to p6) were manipulated to create 33 communities, each
containing one to six species. Additionally, a treatment covariate
representing three nitrogen fertilisation levels (<code>50</code>,
<code>150</code>, and <code>250</code>) in kg/ha/yr was also added with
every community replicated at each treatment level. The species are
categorised into functional groups based on their ecological roles:
<code>p1</code> and <code>p2</code> are classified as grasses,
<code>p3</code> and <code>p4</code> as legumes, and <code>p5</code> and
<code>p6</code> as herbs. The response variable of interest is the
annual aboveground dry-matter yield (in tonnes/ha). The first few rows
of the data are printed below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sim4"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim4</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt;   richness treatment p1 p2 p3 p4 p5 p6 response</span></span>
<span><span class="co">#&gt; 1        1        50  1  0  0  0  0  0   26.325</span></span>
<span><span class="co">#&gt; 2        1        50  1  0  0  0  0  0   29.083</span></span>
<span><span class="co">#&gt; 3        1        50  1  0  0  0  0  0   27.581</span></span>
<span><span class="co">#&gt; 4        1        50  0  1  0  0  0  0   17.391</span></span>
<span><span class="co">#&gt; 5        1        50  0  1  0  0  0  0   15.678</span></span>
<span><span class="co">#&gt; 6        1        50  0  1  0  0  0  0   14.283</span></span>
<span><span class="co">#&gt; 7        1        50  0  0  1  0  0  0   16.317</span></span>
<span><span class="co">#&gt; 8        1        50  0  0  1  0  0  0   19.553</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>We relabel the species columns in the data such that the two grasses
are <code>G1</code> and <code>G2</code>, legumes are <code>L1</code> and
<code>L2</code>, with herbs being <code>H1</code> and <code>H2</code>.
Furthermore we also add the within and between functional group
interaction terms to our data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_data</span> <span class="op">&lt;-</span> <span class="va">sim4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Rename species columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>G1 <span class="op">=</span> <span class="va">p1</span>, G2 <span class="op">=</span> <span class="va">p2</span>, L1 <span class="op">=</span> <span class="va">p3</span>, </span>
<span>         L2 <span class="op">=</span> <span class="va">p4</span>, H1 <span class="op">=</span> <span class="va">p5</span>, H2 <span class="op">=</span> <span class="va">p6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Total functional group proportion</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>G <span class="op">=</span> <span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span>,</span>
<span>         L <span class="op">=</span> <span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span>,</span>
<span>         H <span class="op">=</span> <span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add additional interaction columns to data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wfg_G <span class="op">=</span> <span class="va">G1</span><span class="op">*</span><span class="va">G2</span>, wfg_L <span class="op">=</span> <span class="va">L1</span><span class="op">*</span><span class="va">L2</span>, wfg_H <span class="op">=</span> <span class="va">H1</span><span class="op">*</span><span class="va">H2</span>,</span>
<span>         bfg_GL <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span>,</span>
<span>         bfg_GH <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span>,</span>
<span>         bfg_LH <span class="op">=</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add dummy variables for treatment</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">50</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>         treatment150 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">150</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>         treatment250 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">250</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Rearrange columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">response</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">response</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">model_data</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt;   richness treatment G1 G2 L1 L2 H1 H2 G L H wfg_G wfg_L wfg_H bfg_GL bfg_GH</span></span>
<span><span class="co">#&gt; 1        1        50  1  0  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 2        1        50  1  0  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 3        1        50  1  0  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 4        1        50  0  1  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 5        1        50  0  1  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 6        1        50  0  1  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 7        1        50  0  0  1  0  0  0 0 1 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 8        1        50  0  0  1  0  0  0 0 1 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt;   bfg_LH treatment50 treatment150 treatment250 response</span></span>
<span><span class="co">#&gt; 1      0           1            0            0   26.325</span></span>
<span><span class="co">#&gt; 2      0           1            0            0   29.083</span></span>
<span><span class="co">#&gt; 3      0           1            0            0   27.581</span></span>
<span><span class="co">#&gt; 4      0           1            0            0   17.391</span></span>
<span><span class="co">#&gt; 5      0           1            0            0   15.678</span></span>
<span><span class="co">#&gt; 6      0           1            0            0   14.283</span></span>
<span><span class="co">#&gt; 7      0           1            0            0   16.317</span></span>
<span><span class="co">#&gt; 8      0           1            0            0   19.553</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>A regression model is fit to <code>model_data</code> using the
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function with the model equation as shown below:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>β</mi><mrow><mi>G</mi><mn>1</mn></mrow></msub><msub><mi>p</mi><mrow><mi>G</mi><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mi>G</mi><mn>2</mn></mrow></msub><msub><mi>p</mi><mrow><mi>G</mi><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mi>L</mi><mn>1</mn></mrow></msub><msub><mi>p</mi><mrow><mi>L</mi><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mi>L</mi><mn>2</mn></mrow></msub><msub><mi>p</mi><mrow><mi>L</mi><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mi>H</mi><mn>1</mn></mrow></msub><msub><mi>p</mi><mrow><mi>H</mi><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mi>H</mi><mn>2</mn></mrow></msub><msub><mi>p</mi><mrow><mi>H</mi><mn>2</mn></mrow></msub><mo>+</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mspace width="1.0em"></mspace><msub><mi>ω</mi><mrow><mi>G</mi><mi>L</mi></mrow></msub><msub><mi>p</mi><mi>G</mi></msub><msub><mi>p</mi><mi>L</mi></msub><mo>+</mo><msub><mi>ω</mi><mrow><mi>G</mi><mi>H</mi></mrow></msub><msub><mi>p</mi><mi>G</mi></msub><msub><mi>p</mi><mi>H</mi></msub><mo>+</mo><msub><mi>ω</mi><mrow><mi>L</mi><mi>H</mi></mrow></msub><msub><mi>p</mi><mi>L</mi></msub><msub><mi>p</mi><mi>H</mi></msub><mo>+</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mspace width="1.0em"></mspace><msub><mi>ω</mi><mi>G</mi></msub><msub><mi>p</mi><mrow><mi>G</mi><mn>1</mn></mrow></msub><msub><mi>p</mi><mrow><mi>G</mi><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>ω</mi><mi>L</mi></msub><msub><mi>p</mi><mrow><mi>L</mi><mn>1</mn></mrow></msub><msub><mi>p</mi><mrow><mi>L</mi><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>ω</mi><mi>H</mi></msub><msub><mi>p</mi><mrow><mi>H</mi><mn>1</mn></mrow></msub><msub><mi>p</mi><mrow><mi>H</mi><mn>2</mn></mrow></msub><mo>+</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mspace width="1.0em"></mspace><msub><mi>α</mi><mn>150</mn></msub><msub><mi>A</mi><mn>150</mn></msub><mo>+</mo><msub><mi>α</mi><mn>250</mn></msub><msub><mi>A</mi><mn>250</mn></msub><mo>+</mo><mi>ϵ</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align} 
y &amp;= \beta_{G1} p_{G1} + \beta_{G2} p_{G2} + \beta_{L1} p_{L1} + \beta_{L2} p_{L2} + \beta_{H1} p_{H1} + \beta_{H2} p_{H2} + \nonumber \\ &amp;\quad \quad \omega_{GL} p_{G} p_{L} + \omega_{GH} p_{G} p_{H} + \omega_{LH} p_{L} p_{H} + \nonumber \\ &amp; \quad \quad \omega_{G} p_{G1} p_{G2} + \omega_{L} p_{L1} p_{L2} + \omega_{H} p_{H1} p_{H2} + \nonumber \\ &amp; \quad \quad \alpha_{150} A_{150} + \alpha_{250} A_{250} + \epsilon
\end{align}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
is the response (annual biomass yield),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>G</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">p_{G1}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>G</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">p_{G2}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>L</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">p_{L1}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>L</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">p_{L2}</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>H</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">p_{H1}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>H</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">p_{H2}</annotation></semantics></math>
are the sown proportions and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>G</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\beta_{G1}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>G</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">\beta_{G2}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>L</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\beta_{L1}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>L</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">\beta_{L2}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>H</mi><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\beta_{H1}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>H</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">\beta_{H2}</annotation></semantics></math>
are the identity effects of the six species G1, G2, L1, L2, H1, and H2
respectively.The functional group proportions of grasses, legumes, and
herbs is represented by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>G</mi></msub><annotation encoding="application/x-tex">p_{G}</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>G</mi></msub><mo>=</mo><msub><mi>p</mi><mrow><mi>G</mi><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>p</mi><mrow><mi>G</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">p_{G} = p_{G1} + p_{G2}</annotation></semantics></math>),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>L</mi></msub><annotation encoding="application/x-tex">p_{L}</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>L</mi></msub><mo>=</mo><msub><mi>p</mi><mrow><mi>L</mi><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>p</mi><mrow><mi>L</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">p_{L} = p_{L1} + p_{L2}</annotation></semantics></math>),
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>H</mi></msub><annotation encoding="application/x-tex">p_{H}</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>H</mi></msub><mo>=</mo><msub><mi>p</mi><mrow><mi>H</mi><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>p</mi><mrow><mi>H</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">p_{H} = p_{H1} + p_{H2}</annotation></semantics></math>),
respectively. The between functional group interactions are captured by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mrow><mi>G</mi><mi>L</mi></mrow></msub><annotation encoding="application/x-tex">\omega_{GL}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mrow><mi>G</mi><mi>H</mi></mrow></msub><annotation encoding="application/x-tex">\omega_{GH}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mrow><mi>L</mi><mi>H</mi></mrow></msub><annotation encoding="application/x-tex">\omega_{LH}</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mi>G</mi></msub><annotation encoding="application/x-tex">\omega_{G}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mi>L</mi></msub><annotation encoding="application/x-tex">\omega_{L}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mi>H</mi></msub><annotation encoding="application/x-tex">\omega_{H}</annotation></semantics></math>
capturing the within-functional group interaction for grasses, legumes,
and herbs, respectively. The additional effects of fertiliser treatment
are captured by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mn>150</mn></msub><annotation encoding="application/x-tex">\alpha_{150}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mn>250</mn></msub><annotation encoding="application/x-tex">\alpha_{250}</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mn>150</mn></msub><annotation encoding="application/x-tex">A_{150}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mn>250</mn></msub><annotation encoding="application/x-tex">A_{250}</annotation></semantics></math>
being dummy variables for a specific level of fertiliser treatment.
Finally, the error term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math>
is assumed to be normal with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
and variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>.</p>
<p>The <code>R</code> code for fitting this model using
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> along with the model output is presented below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span> <span class="op">+</span> <span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span> <span class="op">+</span> <span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span> <span class="op">+</span> </span>
<span>                          <span class="va">bfg_GL</span> <span class="op">+</span> <span class="va">bfg_GH</span> <span class="op">+</span> <span class="va">bfg_LH</span> <span class="op">+</span> </span>
<span>                          <span class="va">wfg_G</span> <span class="op">+</span> <span class="va">wfg_L</span> <span class="op">+</span> <span class="va">wfg_H</span> <span class="op">+</span> </span>
<span>                          <span class="va">treatment150</span> <span class="op">+</span> <span class="va">treatment250</span>, </span>
<span>             data <span class="op">=</span> <span class="va">model_data</span><span class="op">)</span></span></code></pre></div>
<p>The model coefficients are as follows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cust_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = response ~ 0 + G1 + G2 + L1 + L2 + H1 + H2 + bfg_GL + </span></span>
<span><span class="co">#&gt;     bfg_GH + bfg_LH + wfg_G + wfg_L + wfg_H + treatment150 + </span></span>
<span><span class="co">#&gt;     treatment250, data = model_data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; G1            26.9878     0.7698  35.057  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; G2            16.9599     0.7698  22.031  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; L1            19.3803     0.7698  25.175  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; L2            21.1189     0.7698  27.434  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; H1            10.4473     0.7698  13.571  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; H2            12.5173     0.7698  16.260  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; bfg_GL        16.1743     2.5691   6.296 4.57e-09 ***</span></span>
<span><span class="co">#&gt; bfg_GH        21.1347     2.5691   8.227 1.96e-13 ***</span></span>
<span><span class="co">#&gt; bfg_LH        26.0550     2.5691  10.142  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; wfg_G         40.8789     5.5387   7.381 1.82e-11 ***</span></span>
<span><span class="co">#&gt; wfg_L         15.6723     5.5387   2.830  0.00542 ** </span></span>
<span><span class="co">#&gt; wfg_H         16.2103     5.5387   2.927  0.00406 ** </span></span>
<span><span class="co">#&gt; treatment150   3.2985     0.4880   6.759 4.51e-10 ***</span></span>
<span><span class="co">#&gt; treatment250   5.8536     0.4880  11.995  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 5.596318)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 93567.57  on 141  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:   710.73  on 127  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 658.21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<div class="notebox">
<p><em>Note:</em> The intercept has been dropped from this model due to
the compositional nature of the predictors in the model.</p>
</div>
<p>We proceed with this model and create visualisations for interpreting
the results.</p>
</div>
<div class="section level3">
<h3 id="visualisations">Visualisations<a class="anchor" aria-label="anchor" href="#visualisations"></a>
</h3>
<p>The model object stored in <code>cust_model</code> will be used for
creating all the visualisations shown in this section. We will follow a
modular plotting workflow where the data needed for each visualisation
will be created first and modified as per our needs and then passed on
to the respective plotting function to create the visualisation.</p>
<p>We first define a common set of variables which will be used across
the board for ease of use</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Names of the compositional predictors (i.e., species) in the model</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"L1"</span>, <span class="st">"L2"</span>, <span class="st">"H1"</span>, <span class="st">"H2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Functional groupings of the species</span></span>
<span><span class="va">FG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G"</span>, <span class="st">"G"</span>, <span class="st">"L"</span>, <span class="st">"L"</span>, <span class="st">"H"</span>, <span class="st">"H"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Colours to be used for the six compostional variables (species) in plots</span></span>
<span><span class="va">var_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_colours.html">get_colours</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="va">species</span>, FG <span class="op">=</span> <span class="va">FG</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="model-diagnostics-plot">Model diagnostics plot<a class="anchor" aria-label="anchor" href="#model-diagnostics-plot"></a>
</h4>
<p>Let’s first examine the model diagnostics plots for our fitted model
to ensure there are no severe problems with the model assumptions.</p>
<p>The data needed for creating the diagnostics plot is prepared using
the <code><a href="../reference/model_diagnostics_data.html">model_diagnostics_data()</a></code> function. The primary
difference here (and in all other functions) compared to using the
wrapper functions designed for use with <code>DImodels</code> objects is
that the names of the compositional predictors should to be specified in
the <code>prop</code> parameter.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diag_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_diagnostics_data.html">model_diagnostics_data</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">cust_model</span>,  <span class="co"># Regression model object</span></span>
<span>  prop <span class="op">=</span> <span class="va">species</span><span class="op">)</span>      <span class="co"># Names of the compositional predictors</span></span></code></pre></div>
<p>The <code><a href="../reference/model_diagnostics_data.html">model_diagnostics_data()</a></code> function returns the
original data fitted to the model with additional columns containing
diagnostic information for each observation. The returned data looks as
follows.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">diag_data</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt;   response G1 G2 L1 L2 H1 H2 bfg_GL bfg_GH bfg_LH wfg_G wfg_L wfg_H</span></span>
<span><span class="co">#&gt; 1   26.325  1  0  0  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt; 2   29.083  1  0  0  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt; 3   27.581  1  0  0  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt; 4   17.391  0  1  0  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt; 5   15.678  0  1  0  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt; 6   14.283  0  1  0  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt; 7   16.317  0  0  1  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt; 8   19.553  0  0  1  0  0  0      0      0      0     0     0     0</span></span>
<span><span class="co">#&gt;   treatment150 treatment250      .hat   .sigma      .cooksd  .fitted     .resid</span></span>
<span><span class="co">#&gt; 1            0            0 0.1058936 2.374202 7.426182e-04 26.98775 -0.6627540</span></span>
<span><span class="co">#&gt; 2            0            0 0.1058936 2.366805 7.422170e-03 26.98775  2.0952460</span></span>
<span><span class="co">#&gt; 3            0            0 0.1058936 2.374365 5.950185e-04 26.98775  0.5932460</span></span>
<span><span class="co">#&gt; 4            0            0 0.1058936 2.374675 3.142566e-04 16.95987  0.4311335</span></span>
<span><span class="co">#&gt; 5            0            0 0.1058936 2.371950 2.778091e-03 16.95987 -1.2818665</span></span>
<span><span class="co">#&gt; 6            0            0 0.1058936 2.361594 1.211475e-02 16.95987 -2.6768665</span></span>
<span><span class="co">#&gt; 7            0            0 0.1058936 2.357422 1.586474e-02 19.38028 -3.0632750</span></span>
<span><span class="co">#&gt; 8            0            0 0.1058936 2.374967 5.043954e-05 19.38028  0.1727250</span></span>
<span><span class="co">#&gt;     .stdresid Obs Label        .qq weights</span></span>
<span><span class="co">#&gt; 1 -0.29628289   1     1 -0.4016478       1</span></span>
<span><span class="co">#&gt; 2  0.93667566   2     2  1.0564117       1</span></span>
<span><span class="co">#&gt; 3  0.26520947   3     3  0.3633920       1</span></span>
<span><span class="co">#&gt; 4  0.19273739   4     4  0.2699041       1</span></span>
<span><span class="co">#&gt; 5 -0.57305593   5     5 -0.5614833       1</span></span>
<span><span class="co">#&gt; 6 -1.19668798   6     6 -1.2655513       1</span></span>
<span><span class="co">#&gt; 7 -1.36943116   7     7 -1.5523965       1</span></span>
<span><span class="co">#&gt; 8  0.07721636   8     8  0.1606864       1</span></span></code></pre></div>
<p>The data-preparation functions also add additional attributes to the
prepared data which are accessed by the plotting functions for creating
the visualisations. In this case, the primary attribute added to the
data is the names of the compositional predictors with the key
<code>"prop"</code> and can be accessed as follows.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">diag_data</span>, <span class="st">"prop"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "G1" "G2" "L1" "L2" "H1" "H2"</span></span></code></pre></div>
<p>The prepared data-frame can be updated if the user desires to add any
additional columns or modify any existing ones and then be passed to the
<code><a href="../reference/model_diagnostics_plot.html">model_diagnostics_plot()</a></code> function for creating the
visualisation as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/model_diagnostics_plot.html">model_diagnostics_plot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">diag_data</span>, <span class="co"># Output data-frame returned by model_diagnostics_data()</span></span>
<span>    which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,  <span class="co"># Only print first 2 plots to save space</span></span>
<span>    pie_colours <span class="op">=</span> <span class="va">var_cols</span> <span class="co"># Colours for the pie-slices</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/diag_plot-1.png" alt="Output from model_diagnostics() function" width="960" style="display: block; margin: auto;"></p>
<p><br></p>
<p>It might be desirable to reduce over-plotting by showing only the
extreme observations as pie-glyphs and rendering the remaining as
points. The <code>only_extremes</code> in conjunction with the
<code>npoints</code> argument can be used.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/model_diagnostics_plot.html">model_diagnostics_plot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">diag_data</span>, </span>
<span>    which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,  </span>
<span>    pie_colours <span class="op">=</span> <span class="va">var_cols</span>,</span>
<span>    only_extremes <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Show only extreme points as pie-glyphs</span></span>
<span>    npoints <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># Show the five most extreme points as pie-glyphs (default is 3)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/diag_plot2-1.png" alt="Output from model_diagnostics() function" width="960" style="display: block; margin: auto;"></p>
<p>The “Residual vs Fitted” plot in the above figure indicates that the
residuals are centered around the <code>y = 0</code> line and have a
relatively constant variance across the board. The “QQ-Plot” indicates
that the normality assumption doesn’t seem to violated. The observations
highlighted with <a href="https://rishvish.github.io/PieGlyph/" class="external-link">pie-glyphs</a> are primarily
containing <code>'H2'</code> which indicates that the model may not be
capturing information about <code>'H2'</code> very well and we might
have to investigate it further.</p>
<p>The figure can also be customised further if needed. For example,
suppose the user wishes to overlay the “Residual vs Fitted” plot with
pie-glyphs but only for those observations receiving the 250 kg nitrogen
treatment. This can be achieved with the following code with the output
shown below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract data for containing observations recieving 250 N treatment</span></span>
<span><span class="va">data_250</span> <span class="op">&lt;-</span> <span class="va">diag_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment250</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We first create the diagnostic plot</span></span>
<span><span class="va">diag_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_diagnostics_plot.html">model_diagnostics_plot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">diag_data</span>, </span>
<span>    which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,   <span class="co"># Only show residual vs fitted plot</span></span>
<span>    pie_colours <span class="op">=</span> <span class="va">var_cols</span>,</span>
<span>    only_extremes <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Show only extreme points as pie-glyphs</span></span>
<span>    npoints <span class="op">=</span> <span class="fl">0</span>, <span class="co"># Show the no extreme points as pie-glyphs</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span>
<span></span>
<span><span class="co"># Now we can use traditional ggplot machinery to modify the plot</span></span>
<span><span class="va">diag_plot</span> <span class="op">+</span> </span>
<span>  <span class="co"># Manually add pie-glyphs using the subsetted data from above</span></span>
<span>  <span class="fu"><a href="https://rishvish.github.io/PieGlyph/reference/geom_pie_glyph.html" class="external-link">geom_pie_glyph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_250</span>, slices <span class="op">=</span> <span class="va">species</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/diag_plot3-1.png" alt="Output from model_diagnostics() function" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="prediction-contributions">Prediction contributions<a class="anchor" aria-label="anchor" href="#prediction-contributions"></a>
</h4>
<p>The <code><a href="../reference/prediction_contributions_data.html">prediction_contributions_data()</a></code> function can be
called to create the template data needed for visualising the
contributions of the various terms in the model to the predicted
response.</p>
<p>We first create a subset of the data for which the predictions
contributions should be visualised. For this example we will visualise
the six monocultures, 50-50 mixtures of the two grasses, legumes and
herb along with the six-species centroid mixture receiving the 250kg
nitrogen treatment. These communities can be subsetted from the data as
follows</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_data</span> <span class="op">&lt;-</span> <span class="va">model_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Filter only those observations recieving 250 N treatment</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment250</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">G1</span>, <span class="va">G2</span>, <span class="va">L1</span>, <span class="va">L2</span>, <span class="va">H1</span>, <span class="va">H2</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Filter specific communities</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="co"># Six monocultures</span></span>
<span>    <span class="op">(</span><span class="va">G1</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">G2</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">L1</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">L2</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">H1</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">H2</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span> </span>
<span>    <span class="co"># Two species mixtures</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">G1</span> <span class="op">==</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">G2</span> <span class="op">==</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">L1</span> <span class="op">==</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">L2</span> <span class="op">==</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">H1</span> <span class="op">==</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">H2</span> <span class="op">==</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="co"># Six species centroid</span></span>
<span>    <span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html" class="external-link">near</a></span><span class="op">(</span><span class="va">G1</span>, <span class="fl">0.16667</span>, tol <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subset_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   richness treatment G1 G2 L1 L2 H1 H2 G L H wfg_G wfg_L wfg_H bfg_GL bfg_GH</span></span>
<span><span class="co">#&gt; 1        1       250  1  0  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 2        1       250  0  1  0  0  0  0 1 0 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 3        1       250  0  0  1  0  0  0 0 1 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 4        1       250  0  0  0  1  0  0 0 1 0     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 5        1       250  0  0  0  0  1  0 0 0 1     0     0     0      0      0</span></span>
<span><span class="co">#&gt; 6        1       250  0  0  0  0  0  1 0 0 1     0     0     0      0      0</span></span>
<span><span class="co">#&gt;   bfg_LH treatment50 treatment150 treatment250 response</span></span>
<span><span class="co">#&gt; 1      0           0            0            1   32.538</span></span>
<span><span class="co">#&gt; 2      0           0            0            1   23.644</span></span>
<span><span class="co">#&gt; 3      0           0            0            1   25.242</span></span>
<span><span class="co">#&gt; 4      0           0            0            1   24.641</span></span>
<span><span class="co">#&gt; 5      0           0            0            1   16.019</span></span>
<span><span class="co">#&gt; 6      0           0            0            1   15.449</span></span></code></pre></div>
<p>This data containing the specific commmunities of interest can be
passed to the <code><a href="../reference/prediction_contributions_data.html">prediction_contributions_data()</a></code> function to
create the template necessary for visualising the contributions.</p>
<div class="notebox">
<p><em>Note:</em> All predictors variables from the model should be
present in the data or the function would throw an error.</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_cont_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prediction_contributions_data.html">prediction_contributions_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">cust_model</span>, <span class="co"># Model used for making predicitons </span></span>
<span>    data <span class="op">=</span> <span class="va">subset_data</span>,  <span class="co"># Data containing the observation for which to make prediction</span></span>
<span>    <span class="co"># X-axis labels to be used for the bars</span></span>
<span>    bar_labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"L1"</span>, <span class="st">"L2"</span>, <span class="st">"H1"</span>, <span class="st">"H2"</span>, <span class="st">"G-G"</span>, <span class="st">"L-L"</span>, <span class="st">"H-H"</span>, <span class="st">"Cent."</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred_cont_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">#&gt;   .x_labs .Community  richness treatment     G     L     H treatment50 response</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: .Pred &lt;dbl&gt;, .Lower &lt;dbl&gt;, .Upper &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   .Contributions &lt;chr&gt;, .Value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The prepared data now contains additional columns
(<code>.Contributions</code> and <code>.Value</code>) which describe the
contributions of each model term to the response for each community. The
predicted response (<code>.Pred</code>) along with the uncertainty (95%
by default) around it is also present (<code>.Upper</code> and
<code>.Lower</code>). Finally, there is additional information about the
grouping and labelling for each community (<code>.Community</code> and
<code>.x_labs</code>).</p>
<div class="notebox">
<p><em>Note:</em> If the data passed to this function had
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows and the model had
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
coefficients, the resultant data will have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>*</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">n*p</annotation></semantics></math>
rows.</p>
</div>
<div class="highlightbox">
<p>If the model was not fit in R, or for some reason if the user doesn’t
have access to the fitted model object, it is also possible to obtain
the same data by using the model coefficients.</p>
<p>Suppose we only had access to the following coefficients.</p>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">mod_coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">cust_model</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           G1           G2           L1           L2           H1           H2 </span></span>
<span><span class="co">#&gt;    26.987754    16.959867    19.380275    21.118863    10.447271    12.517346 </span></span>
<span><span class="co">#&gt;       bfg_GL       bfg_GH       bfg_LH        wfg_G        wfg_L        wfg_H </span></span>
<span><span class="co">#&gt;    16.174287    21.134709    26.054987    40.878915    15.672343    16.210285 </span></span>
<span><span class="co">#&gt; treatment150 treatment250 </span></span>
<span><span class="co">#&gt;     3.298532     5.853617</span></span></code></pre></div>
<div class="highlightbox">
<p>The same data as before could be generated as follows. We specify an
additional argument <code>coeff_cols</code> which gives the names of
columns corresponding to the coefficients.</p>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_cont_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prediction_contributions_data.html">prediction_contributions_data</a></span><span class="op">(</span></span>
<span>    coefficients <span class="op">=</span> <span class="va">mod_coeffs</span>, <span class="co"># Model coeffecients </span></span>
<span>    coeff_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mod_coeffs</span><span class="op">)</span>, <span class="co"># Column names corresponding to the coefficients</span></span>
<span>    data <span class="op">=</span> <span class="va">subset_data</span>,  <span class="co"># Data containing the observation for which to make prediction</span></span>
<span>    <span class="co"># X-axis labels to be used for the bars</span></span>
<span>    bar_labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"L1"</span>, <span class="st">"L2"</span>, <span class="st">"H1"</span>, <span class="st">"H2"</span>, <span class="st">"G-G"</span>, <span class="st">"L-L"</span>, <span class="st">"H-H"</span>, <span class="st">"Cent."</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred_cont_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">#&gt;   .x_labs .Community  richness treatment     G     L     H treatment50 response</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> G1      Community 1        1       250     1     0     0           0     32.5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: .Pred &lt;dbl&gt;, .Lower &lt;dbl&gt;, .Upper &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   .Contributions &lt;chr&gt;, .Value &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="notebox">
<p><em>Note:</em> When using model coefficients for generating the data,
the uncertainty information around the prediction won’t be available by
default. However, this information can be obtained as well if the user
passes the variance-covariance matrix of the coefficients in the
<code>vcov</code> argument.</p>
</div>
<p>Using the prepared data, the prediction-contributions plot can be
generated using the <code><a href="../reference/prediction_contributions_plot.html">prediction_contributions_plot()</a></code>
function. By default, only the data argument is needed, however, it
often helps to manually specify the colours for each contribution via
the <code>'colours'</code> argument to make the plot more
informative.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prediction_contributions_plot.html">prediction_contributions_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pred_cont_data</span>, <span class="co"># Output data from prediction_contributions_data()</span></span>
<span>  colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="co"># Colours for the six species contributions</span></span>
<span>              <span class="va">var_cols</span>, </span>
<span>              <span class="co"># Colours for between FG interactions</span></span>
<span>              <span class="fu"><a href="../reference/get_shades.html">get_shades</a></span><span class="op">(</span><span class="st">"#DDCC77"</span>, shades <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>              <span class="co"># Colours for within FG interactions</span></span>
<span>              <span class="fu"><a href="../reference/get_shades.html">get_shades</a></span><span class="op">(</span><span class="st">"#D55E00"</span>, shades <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>              <span class="co"># Colours for nitrogen treatment</span></span>
<span>              <span class="fu"><a href="../reference/get_shades.html">get_shades</a></span><span class="op">(</span><span class="st">"#505050"</span>, shades <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/pred_cont1-1.png" alt="Output from prediction_contributions_plot() function" width="768" style="display: block; margin: auto;"></p>
<p>The above figure shows the G1 monoculture performs best among
monocultures and has comparable performance to the six-species centroid
mixture. Additionally, the within grass interaction (“wfg_G”) is
stronger than the within legume (“wfg_L”) and within herb (“wfg_H”)
interactions. However, the between FG interactions (“bfg_*“) contribute
more towards the predicted response compared to within FG
interactions.</p>
<p>For situations when there are too many predictors in the model, it is
also possible to group similar terms so that their total contribution is
shown using a single segment on the bar by using the <code>groups</code>
argument in the <code><a href="../reference/prediction_contributions_data.html">prediction_contributions_data()</a></code> function.
The output visualisation with grouped FG interaction terms is shown
below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_cont_data_grouped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prediction_contributions_data.html">prediction_contributions_data</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">cust_model</span>, </span>
<span>    data <span class="op">=</span> <span class="va">subset_data</span>,</span>
<span>    <span class="co"># We group the three between and within FG interactions into single terms</span></span>
<span>    groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Between FG ints."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bfg_GL"</span>, <span class="st">"bfg_GH"</span>, <span class="st">"bfg_LH"</span><span class="op">)</span>,</span>
<span>                  <span class="st">"Within FG ints."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wfg_G"</span>, <span class="st">"wfg_L"</span>, <span class="st">"wfg_H"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># X-axis labels to be used for the bars</span></span>
<span>    bar_labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"L1"</span>, <span class="st">"L2"</span>, <span class="st">"H1"</span>, <span class="st">"H2"</span>, <span class="st">"G-G"</span>, <span class="st">"L-L"</span>, <span class="st">"H-H"</span>, <span class="st">"Cent."</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="co"># Notice the .Contributions column</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred_cont_data_grouped</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 20</span></span></span>
<span><span class="co">#&gt;    .x_labs .Community  richness treatment     G     L     H wfg_G wfg_L wfg_H</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> G1      Community 1        1       250     1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10 more variables: bfg_GL &lt;dbl&gt;, bfg_GH &lt;dbl&gt;, bfg_LH &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   treatment50 &lt;dbl&gt;, response &lt;dbl&gt;, .Pred &lt;dbl&gt;, .Lower &lt;dbl&gt;, .Upper &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   .Contributions &lt;chr&gt;, .Value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Notice how the <code>.Contributions</code> column now has the
combined between and within FG interactions as opposed to those at the
individual functional group level.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grouped_cont_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prediction_contributions_plot.html">prediction_contributions_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pred_cont_data_grouped</span>, <span class="co"># Output data from prediction_contributions_data()</span></span>
<span>  colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="co"># Colours for the six species contributions</span></span>
<span>              <span class="va">var_cols</span>, </span>
<span>              <span class="co"># Colours for nitrogen treatment</span></span>
<span>              <span class="fu"><a href="../reference/get_shades.html">get_shades</a></span><span class="op">(</span><span class="st">"#505050"</span>, shades <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>              <span class="co"># Colours for between FG interactions</span></span>
<span>              <span class="st">"#DDCC77"</span>, </span>
<span>              <span class="co"># Colours for within FG interactions</span></span>
<span>              <span class="st">"#0072B2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span>
<span><span class="va">grouped_cont_plot</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/pred_cont2-1.png" alt="Output from prediction_contributions_plot() function" width="768" style="display: block; margin: auto;"></p>
<p>Finally, the output visualisation can also be customised with
additional annotations if desired. For example, if the user wishes to
overlay a reference line on the plot for comparisons purposes and
separate by bars by species richness, they can do so using as follows.
The output visualisation with these aesthetic changes is shown below</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grouped_cont_plot</span> <span class="op">+</span></span>
<span>  <span class="co"># Add dashed reference line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">25</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>             colour <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">richness</span>, labeller <span class="op">=</span> <span class="va">label_both</span>,</span>
<span>             space <span class="op">=</span> <span class="st">"free_x"</span>, scale <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/pred_cont3-1.png" alt="Plot output" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="conditional-ternary-diagrams">Conditional ternary diagrams<a class="anchor" aria-label="anchor" href="#conditional-ternary-diagrams"></a>
</h4>
<p>The <code><a href="../reference/conditional_ternary_data.html">conditional_ternary_data()</a></code> creates function creates
a template <code>data.frame</code> which can be passed to
<code><a href="../reference/conditional_ternary_plot.html">conditional_ternary_plot()</a></code> for creating conditional ternary
diagrams. For simple models, calling
<code><a href="../reference/conditional_ternary_data.html">conditional_ternary_data()</a></code> would also add the predicted
response across the ternary surface. However, for complex models with
additional non-compositional predictors, by default the function would
try to make predictions for the most reasonable values for these
non-compositional predictors (base level for categorical and median
value for continuous) but that won’t always be desirable. So users have
the option to generate a template data frame without predictions by
setting <code>prediction = FALSE</code>. This template can then be
modified to include any additional variables required for predictions
before being passed to the appropriate plotting function for
visualisation.</p>
<p>The following code shows an example of creating such a template where
we fix <code>G2</code> and <code>L2</code> at specific values and allow
<code>G1</code>, <code>L1</code> and <code>H1</code> to vary between 0
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mn>2</mn><mo>+</mo><mi>L</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">G2 + L2</annotation></semantics></math>.</p>
<div class="notebox">
<p><em>Note:</em> Since <code>H2</code> is not specified here, it is
assumed to be zero.</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond_tern_template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conditional_ternary_data.html">conditional_ternary_data</a></span><span class="op">(</span></span>
<span>  prop <span class="op">=</span> <span class="va">species</span>, <span class="co"># Names of the compositional predictors</span></span>
<span>  tern_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"L1"</span>, <span class="st">"H1"</span><span class="op">)</span>, <span class="co"># Names for the three predictors to show in the ternary</span></span>
<span>  <span class="co"># The values at which to fix the remaining predictors</span></span>
<span>  <span class="co"># Any compositional predictors not specified here (e.g. H2) would be assumed to be 0 </span></span>
<span>  conditional <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"G2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>                           <span class="st">"L2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># Do not add predictions</span></span>
<span>  prediction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cond_tern_template</span><span class="op">)</span></span>
<span><span class="co">#&gt;   G1        L1          H1          .x .y  G2  L2 H2    .Sp   .Value</span></span>
<span><span class="co">#&gt; 1  0 0.7000000 0.000000000 0.000000000  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 2  0 0.6988314 0.001168614 0.001669449  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 3  0 0.6976628 0.002337229 0.003338898  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 4  0 0.6964942 0.003505843 0.005008347  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 5  0 0.6953255 0.004674457 0.006677796  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 6  0 0.6941569 0.005843072 0.008347245  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt;               .Facet</span></span>
<span><span class="co">#&gt; 1 G2 = 0.2; L2 = 0.1</span></span>
<span><span class="co">#&gt; 2 G2 = 0.2; L2 = 0.1</span></span>
<span><span class="co">#&gt; 3 G2 = 0.2; L2 = 0.1</span></span>
<span><span class="co">#&gt; 4 G2 = 0.2; L2 = 0.1</span></span>
<span><span class="co">#&gt; 5 G2 = 0.2; L2 = 0.1</span></span>
<span><span class="co">#&gt; 6 G2 = 0.2; L2 = 0.1</span></span></code></pre></div>
<p>The template has all the necessary columns along with additional
attributes needed for creating conditional ternary diagrams.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">cond_tern_template</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; $names</span></span>
<span><span class="co">#&gt;  [1] "G1"     "L1"     "H1"     ".x"     ".y"     "G2"     "L2"     "H2"    </span></span>
<span><span class="co">#&gt;  [9] ".Sp"    ".Value" ".Facet"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $class</span></span>
<span><span class="co">#&gt; [1] "data.frame"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prop</span></span>
<span><span class="co">#&gt; [1] "G1" "G2" "L1" "L2" "H1" "H2"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tern_vars</span></span>
<span><span class="co">#&gt; [1] "G1" "L1" "H1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $x_proj</span></span>
<span><span class="co">#&gt; [1] ".x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $y_proj</span></span>
<span><span class="co">#&gt; [1] ".y"</span></span></code></pre></div>
<p>The necessary additional columns needed for making the predictions
can be added using a <code>dplyr</code> pipeline or base R.</p>
<div class="notebox">
<p><em>Note:</em> If any specific transformation were made to any
columns in the raw data before model fitting, the same transformation
should be also be added to this template to ensure predictions are
accurate.</p>
</div>
<p>We create datasets for making two ternaries, one for communities at
150 kg nitrogen treatment and other at 250 kg nitrogen treatment. The
between- and within- functional group interaction terms are also added
to the data.</p>
<p>Predicting response for communities at 150 kg nitrogen treatment</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond_tern_template150</span> <span class="op">&lt;-</span> <span class="va">cond_tern_template</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add values for the interaction columns to data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wfg_G <span class="op">=</span> <span class="va">G1</span><span class="op">*</span><span class="va">G2</span>, wfg_L <span class="op">=</span> <span class="va">L1</span><span class="op">*</span><span class="va">L2</span>, wfg_H <span class="op">=</span> <span class="va">H1</span><span class="op">*</span><span class="va">H2</span>,</span>
<span>         bfg_GL <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span>,</span>
<span>         bfg_GH <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span>,</span>
<span>         bfg_LH <span class="op">=</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># We first want ternary for treatment150</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment150 <span class="op">=</span> <span class="fl">1</span>, treatment250 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cond_tern_template150</span><span class="op">)</span></span>
<span><span class="co">#&gt;   G1        L1          H1          .x .y  G2  L2 H2    .Sp   .Value</span></span>
<span><span class="co">#&gt; 1  0 0.7000000 0.000000000 0.000000000  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 2  0 0.6988314 0.001168614 0.001669449  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 3  0 0.6976628 0.002337229 0.003338898  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 4  0 0.6964942 0.003505843 0.005008347  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 5  0 0.6953255 0.004674457 0.006677796  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 6  0 0.6941569 0.005843072 0.008347245  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt;               .Facet wfg_G      wfg_L wfg_H    bfg_GL       bfg_GH       bfg_LH</span></span>
<span><span class="co">#&gt; 1 G2 = 0.2; L2 = 0.1     0 0.07000000     0 0.1600000 0.0000000000 0.0000000000</span></span>
<span><span class="co">#&gt; 2 G2 = 0.2; L2 = 0.1     0 0.06988314     0 0.1597663 0.0002337229 0.0009335258</span></span>
<span><span class="co">#&gt; 3 G2 = 0.2; L2 = 0.1     0 0.06976628     0 0.1595326 0.0004674457 0.0018643203</span></span>
<span><span class="co">#&gt; 4 G2 = 0.2; L2 = 0.1     0 0.06964942     0 0.1592988 0.0007011686 0.0027923835</span></span>
<span><span class="co">#&gt; 5 G2 = 0.2; L2 = 0.1     0 0.06953255     0 0.1590651 0.0009348915 0.0037177154</span></span>
<span><span class="co">#&gt; 6 G2 = 0.2; L2 = 0.1     0 0.06941569     0 0.1588314 0.0011686144 0.0046403159</span></span>
<span><span class="co">#&gt;   treatment150 treatment250</span></span>
<span><span class="co">#&gt; 1            1            0</span></span>
<span><span class="co">#&gt; 2            1            0</span></span>
<span><span class="co">#&gt; 3            1            0</span></span>
<span><span class="co">#&gt; 4            1            0</span></span>
<span><span class="co">#&gt; 5            1            0</span></span>
<span><span class="co">#&gt; 6            1            0</span></span></code></pre></div>
<p>Predicting response for communities at 150 kg nitrogen treatment</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond_tern_template250</span> <span class="op">&lt;-</span> <span class="va">cond_tern_template</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add additional interaction columns to data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wfg_G <span class="op">=</span> <span class="va">G1</span><span class="op">*</span><span class="va">G2</span>, wfg_L <span class="op">=</span> <span class="va">L1</span><span class="op">*</span><span class="va">L2</span>, wfg_H <span class="op">=</span> <span class="va">H1</span><span class="op">*</span><span class="va">H2</span>,</span>
<span>         bfg_GL <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span>,</span>
<span>         bfg_GH <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span>,</span>
<span>         bfg_LH <span class="op">=</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># This will create ternary for treatment250</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment150 <span class="op">=</span> <span class="fl">0</span>, treatment250 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cond_tern_template250</span><span class="op">)</span></span>
<span><span class="co">#&gt;   G1        L1          H1          .x .y  G2  L2 H2    .Sp   .Value</span></span>
<span><span class="co">#&gt; 1  0 0.7000000 0.000000000 0.000000000  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 2  0 0.6988314 0.001168614 0.001669449  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 3  0 0.6976628 0.002337229 0.003338898  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 4  0 0.6964942 0.003505843 0.005008347  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 5  0 0.6953255 0.004674457 0.006677796  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 6  0 0.6941569 0.005843072 0.008347245  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt;               .Facet wfg_G      wfg_L wfg_H    bfg_GL       bfg_GH       bfg_LH</span></span>
<span><span class="co">#&gt; 1 G2 = 0.2; L2 = 0.1     0 0.07000000     0 0.1600000 0.0000000000 0.0000000000</span></span>
<span><span class="co">#&gt; 2 G2 = 0.2; L2 = 0.1     0 0.06988314     0 0.1597663 0.0002337229 0.0009335258</span></span>
<span><span class="co">#&gt; 3 G2 = 0.2; L2 = 0.1     0 0.06976628     0 0.1595326 0.0004674457 0.0018643203</span></span>
<span><span class="co">#&gt; 4 G2 = 0.2; L2 = 0.1     0 0.06964942     0 0.1592988 0.0007011686 0.0027923835</span></span>
<span><span class="co">#&gt; 5 G2 = 0.2; L2 = 0.1     0 0.06953255     0 0.1590651 0.0009348915 0.0037177154</span></span>
<span><span class="co">#&gt; 6 G2 = 0.2; L2 = 0.1     0 0.06941569     0 0.1588314 0.0011686144 0.0046403159</span></span>
<span><span class="co">#&gt;   treatment150 treatment250</span></span>
<span><span class="co">#&gt; 1            0            1</span></span>
<span><span class="co">#&gt; 2            0            1</span></span>
<span><span class="co">#&gt; 3            0            1</span></span>
<span><span class="co">#&gt; 4            0            1</span></span>
<span><span class="co">#&gt; 5            0            1</span></span>
<span><span class="co">#&gt; 6            0            1</span></span></code></pre></div>
<div class="{highlightbox}">
<p>Once we have all the necessary columns needed for making predictions,
they can be added either using the base R <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>
function or the <code><a href="../reference/add_prediction.html">add_prediction()</a></code> function from
<code>DImodelsVis</code>. Both examples are shown here. Additionally, we
also show an example of how to generate the predictions using model
coefficients and their variance-covariance matrix instead of the model
object.</p>
</div>
<div class="{notebox}">
<p><em>Note:</em> If using the base R <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function,
please ensure that the predictions are stored in a column called
<strong>“.Pred”</strong> as this is the column that the visualisation
function accepts the predictions to be in.</p>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add predictions using helper function from DImodelsVis</span></span>
<span><span class="va">cond_tern_template150</span> <span class="op">&lt;-</span> <span class="va">cond_tern_template150</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">cust_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add predictions using model coefficients</span></span>
<span><span class="va">mod_coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">cust_model</span><span class="op">)</span> <span class="co"># Coefficients</span></span>
<span><span class="va">vcov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">cust_model</span><span class="op">)</span>           <span class="co"># vcov matrix of coefficients</span></span>
<span></span>
<span><span class="va">cond_tern_template150</span> <span class="op">&lt;-</span> <span class="va">cond_tern_template150</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span>coefficients <span class="op">=</span> <span class="va">mod_coeffs</span>,</span>
<span>                 vcov <span class="op">=</span> <span class="va">vcov_mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add predictions using base R predict function</span></span>
<span><span class="va">cond_tern_template250</span><span class="op">$</span><span class="va">.Pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cust_model</span>,</span>
<span>                                       newdata <span class="op">=</span> <span class="va">cond_tern_template250</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cond_tern_template150</span><span class="op">)</span></span>
<span><span class="co">#&gt;   G1        L1          H1          .x .y  G2  L2 H2    .Sp   .Value</span></span>
<span><span class="co">#&gt; 1  0 0.7000000 0.000000000 0.000000000  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 2  0 0.6988314 0.001168614 0.001669449  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 3  0 0.6976628 0.002337229 0.003338898  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 4  0 0.6964942 0.003505843 0.005008347  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 5  0 0.6953255 0.004674457 0.006677796  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 6  0 0.6941569 0.005843072 0.008347245  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt;               .Facet wfg_G      wfg_L wfg_H    bfg_GL       bfg_GH       bfg_LH</span></span>
<span><span class="co">#&gt; 1 G2 = 0.2; L2 = 0.1     0 0.07000000     0 0.1600000 0.0000000000 0.0000000000</span></span>
<span><span class="co">#&gt; 2 G2 = 0.2; L2 = 0.1     0 0.06988314     0 0.1597663 0.0002337229 0.0009335258</span></span>
<span><span class="co">#&gt; 3 G2 = 0.2; L2 = 0.1     0 0.06976628     0 0.1595326 0.0004674457 0.0018643203</span></span>
<span><span class="co">#&gt; 4 G2 = 0.2; L2 = 0.1     0 0.06964942     0 0.1592988 0.0007011686 0.0027923835</span></span>
<span><span class="co">#&gt; 5 G2 = 0.2; L2 = 0.1     0 0.06953255     0 0.1590651 0.0009348915 0.0037177154</span></span>
<span><span class="co">#&gt; 6 G2 = 0.2; L2 = 0.1     0 0.06941569     0 0.1588314 0.0011686144 0.0046403159</span></span>
<span><span class="co">#&gt;   treatment150 treatment250    .Pred</span></span>
<span><span class="co">#&gt; 1            1            0 26.05353</span></span>
<span><span class="co">#&gt; 2            1            0 26.06675</span></span>
<span><span class="co">#&gt; 3            1            0 26.07989</span></span>
<span><span class="co">#&gt; 4            1            0 26.09296</span></span>
<span><span class="co">#&gt; 5            1            0 26.10595</span></span>
<span><span class="co">#&gt; 6            1            0 26.11888</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cond_tern_template250</span><span class="op">)</span></span>
<span><span class="co">#&gt;   G1        L1          H1          .x .y  G2  L2 H2    .Sp   .Value</span></span>
<span><span class="co">#&gt; 1  0 0.7000000 0.000000000 0.000000000  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 2  0 0.6988314 0.001168614 0.001669449  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 3  0 0.6976628 0.002337229 0.003338898  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 4  0 0.6964942 0.003505843 0.005008347  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 5  0 0.6953255 0.004674457 0.006677796  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt; 6  0 0.6941569 0.005843072 0.008347245  0 0.2 0.1  0 G2, L2 0.2, 0.1</span></span>
<span><span class="co">#&gt;               .Facet wfg_G      wfg_L wfg_H    bfg_GL       bfg_GH       bfg_LH</span></span>
<span><span class="co">#&gt; 1 G2 = 0.2; L2 = 0.1     0 0.07000000     0 0.1600000 0.0000000000 0.0000000000</span></span>
<span><span class="co">#&gt; 2 G2 = 0.2; L2 = 0.1     0 0.06988314     0 0.1597663 0.0002337229 0.0009335258</span></span>
<span><span class="co">#&gt; 3 G2 = 0.2; L2 = 0.1     0 0.06976628     0 0.1595326 0.0004674457 0.0018643203</span></span>
<span><span class="co">#&gt; 4 G2 = 0.2; L2 = 0.1     0 0.06964942     0 0.1592988 0.0007011686 0.0027923835</span></span>
<span><span class="co">#&gt; 5 G2 = 0.2; L2 = 0.1     0 0.06953255     0 0.1590651 0.0009348915 0.0037177154</span></span>
<span><span class="co">#&gt; 6 G2 = 0.2; L2 = 0.1     0 0.06941569     0 0.1588314 0.0011686144 0.0046403159</span></span>
<span><span class="co">#&gt;   treatment150 treatment250    .Pred</span></span>
<span><span class="co">#&gt; 1            0            1 28.60862</span></span>
<span><span class="co">#&gt; 2            0            1 28.62183</span></span>
<span><span class="co">#&gt; 3            0            1 28.63497</span></span>
<span><span class="co">#&gt; 4            0            1 28.64804</span></span>
<span><span class="co">#&gt; 5            0            1 28.66104</span></span>
<span><span class="co">#&gt; 6            0            1 28.67397</span></span></code></pre></div>
<p>These datasets with predictions can then be passed to the
<code><a href="../reference/conditional_ternary_plot.html">conditional_ternary_plot()</a></code> function to create the
conditional ternary diagrams. The output visualisation for 150 kg and
250 kg nitrogen treatment are shown below.</p>
<p>To ensure the contours across the two plots are comparable we add the
same upper and lower limits across the two using the
<code>lower_lim</code> and <code>upper_lim</code> arguments.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lwr_lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cond_tern_template150</span><span class="op">$</span><span class="va">.Pred</span>, <span class="va">cond_tern_template250</span><span class="op">$</span><span class="va">.Pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">upr_lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cond_tern_template150</span><span class="op">$</span><span class="va">.Pred</span>, <span class="va">cond_tern_template250</span><span class="op">$</span><span class="va">.Pred</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/conditional_ternary_plot.html">conditional_ternary_plot</a></span><span class="op">(</span><span class="va">cond_tern_template150</span>,</span>
<span>                         contour_text <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         lower_lim <span class="op">=</span> <span class="va">lwr_lim</span>,</span>
<span>                         upper_lim <span class="op">=</span> <span class="va">upr_lim</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/cond_tern1-1.png" alt="Output from conditional_ternary_plot() function" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/conditional_ternary_plot.html">conditional_ternary_plot</a></span><span class="op">(</span><span class="va">cond_tern_template250</span>,</span>
<span>                         contour_text <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         lower_lim <span class="op">=</span> <span class="va">lwr_lim</span>,</span>
<span>                         upper_lim <span class="op">=</span> <span class="va">upr_lim</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/cond_tern2-1.png" alt="Output from conditional_ternary_plot() function" width="672" style="display: block; margin: auto;"></p>
<p>The contours appear to have the same structure across the two
treatment levels, but the predicted yields are higher for the
communities receiving 250 kg of N/ha/annum. Within a given level of the
treatment, the predicted yield is maximised by increasing the proportion
of G1.</p>
</div>
<div class="section level4">
<h4 id="grouped-ternary-diagrams">Grouped ternary diagrams<a class="anchor" aria-label="anchor" href="#grouped-ternary-diagrams"></a>
</h4>
<p>The <code><a href="../reference/grouped_ternary_data.html">grouped_ternary_data()</a></code> creates function creates a
template <code>data.frame</code> which can be passed to
<code><a href="../reference/grouped_ternary_plot.html">grouped_ternary_plot()</a></code> for creating grouped ternary
diagrams. All functionality of this function is similar to that of the
data-preparation and plotting functions for conditional ternary
diagrams.</p>
<p>As an example, we first call the <code><a href="../reference/grouped_ternary_data.html">grouped_ternary_data()</a></code>
function to create a template <code>data.frame</code> for grouped
ternary diagram to which we will add the predictions later.
Additionally, we use the <code>add_var</code> argument to specify that
we want to fix treatment to be at 50 and 250 kg/annum. These values can
still be added later to the data as we did for the example in the
conditional ternary section. However, the benefit for adding them using
<code>add_var</code> is that the function adds a special column to the
data which will notify the plotting function to show the ternaries as
separate panels within the same plot which allows us to avoid having to
create separate plots for the two treatment levels.</p>
<div class="{notebox}">
<p><em>Note:</em> The <code>add_var</code> argument is available for all
data-preparation functions in the package.}</p>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_tern_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grouped_ternary_data.html">grouped_ternary_data</a></span><span class="op">(</span></span>
<span>  prediction <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># Do not make predictions now</span></span>
<span>  prop <span class="op">=</span> <span class="va">species</span>,                             <span class="co"># Compositional predictors</span></span>
<span>  FG <span class="op">=</span> <span class="va">FG</span>,                                    <span class="co"># Functional grouping</span></span>
<span>  <span class="co"># Relative split within each FG. Equal split in this example</span></span>
<span>  values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>,    </span>
<span>  <span class="co"># Values for additional non-compsitional predictors</span></span>
<span>  add_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>treatment150 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,      </span>
<span>                 treatment250 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">group_tern_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   G         L           H          .x .y G1 G2        L1        L2           H1</span></span>
<span><span class="co">#&gt; 1 0 1.0000000 0.000000000 0.000000000  0  0  0 0.5000000 0.5000000 0.0000000000</span></span>
<span><span class="co">#&gt; 2 0 0.9983306 0.001669449 0.001669449  0  0  0 0.4991653 0.4991653 0.0008347245</span></span>
<span><span class="co">#&gt; 3 0 0.9966611 0.003338898 0.003338898  0  0  0 0.4983306 0.4983306 0.0016694491</span></span>
<span><span class="co">#&gt; 4 0 0.9949917 0.005008347 0.005008347  0  0  0 0.4974958 0.4974958 0.0025041736</span></span>
<span><span class="co">#&gt; 5 0 0.9933222 0.006677796 0.006677796  0  0  0 0.4966611 0.4966611 0.0033388982</span></span>
<span><span class="co">#&gt; 6 0 0.9916528 0.008347245 0.008347245  0  0  0 0.4958264 0.4958264 0.0041736227</span></span>
<span><span class="co">#&gt;             H2 treatment150 treatment250                        .add_str_ID</span></span>
<span><span class="co">#&gt; 1 0.0000000000            0            0 treatment150: 0; \ttreatment250: 0</span></span>
<span><span class="co">#&gt; 2 0.0008347245            0            0 treatment150: 0; \ttreatment250: 0</span></span>
<span><span class="co">#&gt; 3 0.0016694491            0            0 treatment150: 0; \ttreatment250: 0</span></span>
<span><span class="co">#&gt; 4 0.0025041736            0            0 treatment150: 0; \ttreatment250: 0</span></span>
<span><span class="co">#&gt; 5 0.0033388982            0            0 treatment150: 0; \ttreatment250: 0</span></span>
<span><span class="co">#&gt; 6 0.0041736227            0            0 treatment150: 0; \ttreatment250: 0</span></span></code></pre></div>
<p>The <code>.add_str_ID</code> column in the data notifies the plotting
function that we wish to have separate ternaries for each unique value
in this column. Optionally, we can edit the values in this column to get
more informative labels.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_tern_data</span> <span class="op">&lt;-</span> <span class="va">group_tern_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.add_str_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.add_str_ID</span> <span class="op">==</span> <span class="st">"treatment150: 0; \ttreatment250: 0"</span>,</span>
<span>                              <span class="st">"Treatment: 50"</span>, <span class="st">"Treatment: 250"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now add any interaction columns needed for making predictions
and generate the predictions using any of the previously highlighted
methods. The prepared data with the predictions added can then be passed
to the <code><a href="../reference/grouped_ternary_plot.html">grouped_ternary_plot()</a></code> function to generate the
visualisation. Additionally, we also show how the plot object can be
further updated to include the best-performing community in each ternary
using the <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point()</a></code> function from
<code>ggplot2</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add interaction columns and the prediction</span></span>
<span><span class="va">group_tern_data</span> <span class="op">&lt;-</span> <span class="va">group_tern_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add additional interaction columns to data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wfg_G <span class="op">=</span> <span class="va">G1</span><span class="op">*</span><span class="va">G2</span>, wfg_L <span class="op">=</span> <span class="va">L1</span><span class="op">*</span><span class="va">L2</span>, wfg_H <span class="op">=</span> <span class="va">H1</span><span class="op">*</span><span class="va">H2</span>,</span>
<span>         bfg_GL <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span>,</span>
<span>         bfg_GH <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span>,</span>
<span>         bfg_LH <span class="op">=</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add predictions</span></span>
<span>  <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">cust_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create visualisation</span></span>
<span><span class="va">group_tern_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grouped_ternary_plot.html">grouped_ternary_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">group_tern_data</span>,</span>
<span>  lower_lim <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  upper_lim <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  nlevels <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span>
<span></span>
<span><span class="co"># Update plot to highlight the best-performing community in each ternary</span></span>
<span><span class="va">group_tern_plot</span> <span class="op">+</span></span>
<span>  <span class="co"># Add point highlighting the best performing community in each ternary</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.Pred</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">.Pred</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"#505050"</span>, shape <span class="op">=</span> <span class="fl">18</span>, size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Reduce size of legend so they fit</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.07</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/group_tern-1.png" alt="Output from grouped_ternary_plot() function" width="768" style="display: block; margin: auto;"></p>
<p>The contours appear to have the same structure across the two
treatment levels, but the predicted yields are higher for the
communities receiving 250 kg of N/annum. Within a given level of the
treatment, the predicted yield is maximised by increasing the proportion
of the grasses (G). The best performing community at each treatment
level contains 100% grasses with no other functional group. Since the FG
proportion is split equally between the component species in this
example, the best performing community contains 50% each of G1 and
G2.</p>
</div>
<div class="section level4">
<h4 id="simplex-path-plot">Simplex path plot<a class="anchor" aria-label="anchor" href="#simplex-path-plot"></a>
</h4>
<p>For this example, the simplex-path plots would be useful to visualise
the effect of increasing the functional group proportion on the
predicted yield. We will visualise the change in the predicted yield
between the six-species centroid mixture and the binary mixtures
containing the two species from each functional group.</p>
<p>We prepare the data for the visualisation using the
<code><a href="../reference/simplex_path_data.html">simplex_path_data()</a></code> function. As before, first the template
without predictions is prepared and then predictions are added in
manually after adding in any additional columns needed for the
predictions.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">G1</span>, <span class="op">~</span><span class="va">G2</span>, <span class="op">~</span><span class="va">L1</span>, <span class="op">~</span><span class="va">L2</span>, <span class="op">~</span><span class="va">H1</span>, <span class="op">~</span><span class="va">H2</span>,</span>
<span>                  <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">ends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">G1</span>, <span class="op">~</span><span class="va">G2</span>, <span class="op">~</span><span class="va">L1</span>, <span class="op">~</span><span class="va">L2</span>, <span class="op">~</span><span class="va">H1</span>, <span class="op">~</span><span class="va">H2</span>,</span>
<span>                <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,   <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">0</span>,  <span class="fl">0</span>,</span>
<span>                  <span class="fl">0</span>,   <span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,   <span class="fl">0</span>,  <span class="fl">0</span>,</span>
<span>                  <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">path_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simplex_path_data.html">simplex_path_data</a></span><span class="op">(</span></span>
<span>  starts <span class="op">=</span> <span class="va">starts</span>,               <span class="co"># Starting compositions</span></span>
<span>  ends <span class="op">=</span> <span class="va">ends</span>,                   <span class="co"># Ending compositions</span></span>
<span>  prop <span class="op">=</span> <span class="va">species</span>,                <span class="co"># Names of compositional predictors</span></span>
<span>  prediction <span class="op">=</span> <span class="cn">FALSE</span>,            <span class="co"># Don't make predictions now</span></span>
<span>  <span class="co"># We will visualise the paths at 150 and 250 level of treatment</span></span>
<span>  add_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"150"</span>, <span class="st">"250"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span></code></pre></div>
<p>Let’s now add the interaction terms and convert the treatments into
dummy variables.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_data</span> <span class="op">&lt;-</span> <span class="va">path_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add additional interaction columns to data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wfg_G <span class="op">=</span> <span class="va">G1</span><span class="op">*</span><span class="va">G2</span>, wfg_L <span class="op">=</span> <span class="va">L1</span><span class="op">*</span><span class="va">L2</span>, wfg_H <span class="op">=</span> <span class="va">H1</span><span class="op">*</span><span class="va">H2</span>,</span>
<span>         bfg_GL <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span>,</span>
<span>         bfg_GH <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span>,</span>
<span>         bfg_LH <span class="op">=</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add dummy variables for treatment</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">50</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>         treatment150 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">150</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>         treatment250 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">250</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add predictions and uncertainty around it</span></span>
<span>  <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">cust_model</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">path_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;          G1        G2        L1        L2        H1        H2 .InterpConst</span></span>
<span><span class="co">#&gt; 1 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667         0.00</span></span>
<span><span class="co">#&gt; 2 0.1700000 0.1700000 0.1650000 0.1650000 0.1650000 0.1650000         0.01</span></span>
<span><span class="co">#&gt; 3 0.1733333 0.1733333 0.1633333 0.1633333 0.1633333 0.1633333         0.02</span></span>
<span><span class="co">#&gt; 4 0.1766667 0.1766667 0.1616667 0.1616667 0.1616667 0.1616667         0.03</span></span>
<span><span class="co">#&gt; 5 0.1800000 0.1800000 0.1600000 0.1600000 0.1600000 0.1600000         0.04</span></span>
<span><span class="co">#&gt; 6 0.1833333 0.1833333 0.1583333 0.1583333 0.1583333 0.1583333         0.05</span></span>
<span><span class="co">#&gt;   .Group treatment    .add_str_ID      wfg_G      wfg_L      wfg_H    bfg_GL</span></span>
<span><span class="co">#&gt; 1      1       150 treatment: 150 0.02777778 0.02777778 0.02777778 0.1111111</span></span>
<span><span class="co">#&gt; 2      1       150 treatment: 150 0.02890000 0.02722500 0.02722500 0.1122000</span></span>
<span><span class="co">#&gt; 3      1       150 treatment: 150 0.03004444 0.02667778 0.02667778 0.1132444</span></span>
<span><span class="co">#&gt; 4      1       150 treatment: 150 0.03121111 0.02613611 0.02613611 0.1142444</span></span>
<span><span class="co">#&gt; 5      1       150 treatment: 150 0.03240000 0.02560000 0.02560000 0.1152000</span></span>
<span><span class="co">#&gt; 6      1       150 treatment: 150 0.03361111 0.02506944 0.02506944 0.1161111</span></span>
<span><span class="co">#&gt;      bfg_GH    bfg_LH treatment50 treatment150 treatment250    .Pred   .Lower</span></span>
<span><span class="co">#&gt; 1 0.1111111 0.1111111           0            1            0 30.26202 29.35551</span></span>
<span><span class="co">#&gt; 2 0.1122000 0.1089000           0            1            0 30.31401 29.40732</span></span>
<span><span class="co">#&gt; 3 0.1132444 0.1067111           0            1            0 30.36600 29.45878</span></span>
<span><span class="co">#&gt; 4 0.1142444 0.1045444           0            1            0 30.41800 29.50990</span></span>
<span><span class="co">#&gt; 5 0.1152000 0.1024000           0            1            0 30.47000 29.56069</span></span>
<span><span class="co">#&gt; 6 0.1161111 0.1002778           0            1            0 30.52201 29.61114</span></span>
<span><span class="co">#&gt;     .Upper</span></span>
<span><span class="co">#&gt; 1 31.16854</span></span>
<span><span class="co">#&gt; 2 31.22070</span></span>
<span><span class="co">#&gt; 3 31.27322</span></span>
<span><span class="co">#&gt; 4 31.32609</span></span>
<span><span class="co">#&gt; 5 31.37932</span></span>
<span><span class="co">#&gt; 6 31.43289</span></span></code></pre></div>
<p>The data is expanded to include the following columns *
<code>.InterpConst</code>: The interpolation constant between the start
and end points (will be between 0 and 1). * <code>.Group</code>: An
identifier for creating the <code>effects</code> curve. *
<code>.Pred</code>: The predicted response for a community. *
<code>.Lower</code>: The lower interval (at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.05</annotation></semantics></math>
level) for the predicted response. * <code>.Upper</code>: The upper
interval (at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.05</annotation></semantics></math>
level) for the predicted response.</p>
<div class="notebox">
<p><em>Note:</em> As mentioned earlier, any columns added to the data
before model-fitting should also be added to the template generated from
the data-preparation functions to ensure we get accurate predictions.
One could also add these columns directly to the <code>starts</code> and
<code>ends</code> data.frames as well. However, it is recommended to not
do so for two reasons. First, using the <code>add_var</code> argument
will notify the corresponding plotting function to show the plots in
separate panels for values specified in it. Secondly, the
data-preparation functions might not always calculate the interaction
terms properly if they are added before generating the template.}</p>
</div>
<p>The prepared data can then be passed to the
<code><a href="../reference/simplex_path_plot.html">simplex_path_plot()</a></code> function to create the visualisation.
We also demonstrate how certain plot aesthetics can be modified using
the arguments from the <code><a href="../reference/simplex_path_plot.html">simplex_path_plot()</a></code> function as well
as the <code><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs()</a></code> function from <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/simplex_path_plot.html">simplex_path_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">path_data</span>,       <span class="co"># Data</span></span>
<span>  pie_colours <span class="op">=</span> <span class="va">var_cols</span>, <span class="co"># Colours for the pie-glyphs</span></span>
<span>  pie_radius <span class="op">=</span> <span class="fl">0.35</span>,      <span class="co"># Radius of pie-glyphs</span></span>
<span>  se <span class="op">=</span> <span class="cn">TRUE</span>,              <span class="co"># Show confidence band around predictions</span></span>
<span>  <span class="co"># Show pie-glyphs at 0%, 25%, 50%, 75% and 100% along each path</span></span>
<span>  pie_positions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span> <span class="co"># Arrange all plots in a 1 row and 2 columns</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Predicted yield"</span>, fill <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">path_data</span><span class="op">$</span><span class="va">.Lower</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">path_data</span><span class="op">$</span><span class="va">.Upper</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/path-plot-1.png" alt="Output from simplex_path_plot() function" width="960" style="display: block; margin: auto;"></p>
<p>The predicted yield for every community is higher at the 250
treatment level compared to the 150 level. At each level of treatment,
compared to the centroid community the predicted yield increases as the
sown proportion of grasses increases and decreases as the sown
proportion of legumes and herbs increases.</p>
</div>
<div class="section level4">
<h4 id="effect-plots">Effect plots<a class="anchor" aria-label="anchor" href="#effect-plots"></a>
</h4>
<p>For generating effects plot, just like the previous examples, we
first prepare the data for the visualisation using the
<code><a href="../reference/visualise_effects_data.html">visualise_effects_data()</a></code> function. We use the same
subset-data that used earlier with the
<code><a href="../reference/prediction_contributions_data.html">prediction_contributions_data()</a></code> function and included the
six monocultures, 50-50 mixtures of the two grasses, legumes and herb
along with the six-species centroid mixture receiving the 250kg nitrogen
treatment.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">effects_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualise_effects_data.html">visualise_effects_data</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">subset_data</span>,            <span class="co"># Data containing the communities to use for plot</span></span>
<span>  prop <span class="op">=</span> <span class="va">species</span>,                <span class="co"># Names of compositional predictors</span></span>
<span>  var_interest <span class="op">=</span> <span class="va">species</span>,        <span class="co"># Generate effects plot for all species</span></span>
<span>  prediction <span class="op">=</span> <span class="cn">FALSE</span>             <span class="co"># Don't make predictions now</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span></code></pre></div>
<p>Let’s add the interaction terms and generate the predictions.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">effects_data</span> <span class="op">&lt;-</span> <span class="va">effects_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add additional interaction columns to data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wfg_G <span class="op">=</span> <span class="va">G1</span><span class="op">*</span><span class="va">G2</span>, wfg_L <span class="op">=</span> <span class="va">L1</span><span class="op">*</span><span class="va">L2</span>, wfg_H <span class="op">=</span> <span class="va">H1</span><span class="op">*</span><span class="va">H2</span>,</span>
<span>         bfg_GL <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span>,</span>
<span>         bfg_GH <span class="op">=</span> <span class="op">(</span><span class="va">G1</span> <span class="op">+</span> <span class="va">G2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span>,</span>
<span>         bfg_LH <span class="op">=</span> <span class="op">(</span><span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">H1</span> <span class="op">+</span> <span class="va">H2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Add predictions</span></span>
<span>  <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">cust_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">effects_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;     G1   G2 L1 L2 H1 H2 richness treatment G L H  wfg_G wfg_L wfg_H bfg_GL</span></span>
<span><span class="co">#&gt; 1 0.00 1.00  0  0  0  0        1       250 1 0 0 0.0000     0     0      0</span></span>
<span><span class="co">#&gt; 2 0.01 0.99  0  0  0  0        1       250 1 0 0 0.0099     0     0      0</span></span>
<span><span class="co">#&gt; 3 0.02 0.98  0  0  0  0        1       250 1 0 0 0.0196     0     0      0</span></span>
<span><span class="co">#&gt; 4 0.03 0.97  0  0  0  0        1       250 1 0 0 0.0291     0     0      0</span></span>
<span><span class="co">#&gt; 5 0.04 0.96  0  0  0  0        1       250 1 0 0 0.0384     0     0      0</span></span>
<span><span class="co">#&gt; 6 0.05 0.95  0  0  0  0        1       250 1 0 0 0.0475     0     0      0</span></span>
<span><span class="co">#&gt;   bfg_GH bfg_LH treatment50 treatment150 treatment250 response .Sp .Proportion</span></span>
<span><span class="co">#&gt; 1      0      0           0            0            1   23.644  G1        0.00</span></span>
<span><span class="co">#&gt; 2      0      0           0            0            1   23.644  G1        0.01</span></span>
<span><span class="co">#&gt; 3      0      0           0            0            1   23.644  G1        0.02</span></span>
<span><span class="co">#&gt; 4      0      0           0            0            1   23.644  G1        0.03</span></span>
<span><span class="co">#&gt; 5      0      0           0            0            1   23.644  G1        0.04</span></span>
<span><span class="co">#&gt; 6      0      0           0            0            1   23.644  G1        0.05</span></span>
<span><span class="co">#&gt;   .Group  .Effect    .Pred</span></span>
<span><span class="co">#&gt; 1      1 increase 22.81348</span></span>
<span><span class="co">#&gt; 2      1 increase 23.31846</span></span>
<span><span class="co">#&gt; 3      1 increase 23.81527</span></span>
<span><span class="co">#&gt; 4      1 increase 24.30390</span></span>
<span><span class="co">#&gt; 5      1 increase 24.78435</span></span>
<span><span class="co">#&gt; 6      1 increase 25.25663</span></span></code></pre></div>
<p>The data is expanded to include the following columns</p>
<ul>
<li>
<code>.Sp</code>: The variable of interest who’s proportion is
changed.</li>
<li>
<code>.Proportion</code>: The proportion of the variable of interest
in a community.</li>
<li>
<code>.Group</code>: An identifier for creating the
<code>effects</code> curve.</li>
<li>
<code>.Effect</code>: A string describing whether the proportion of
the variable of interest is increased or decreased.</li>
<li>
<code>.Pred</code>: The predicted response for a community.</li>
<li>
<code>.Lower</code>: The lower interval (at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow></mrow><annotation encoding="application/x-tex">% confidence level = 0.95</annotation></semantics></math>
level) for the predicted response.</li>
<li>
<code>.Upper</code>: The upper interval (at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow></mrow><annotation encoding="application/x-tex">% confidence level = 0.95</annotation></semantics></math>
level) for the predicted response.</li>
</ul>
<p>The prepared data with the predicted yields can then be passed to the
<code><a href="../reference/visualise_effects_plot.html">visualise_effects_plot()</a></code> to generate the effects plot for
each compositional predictor.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualise_effects_plot.html">visualise_effects_plot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">effects_data</span>,    <span class="co"># Data</span></span>
<span>  pie_colours <span class="op">=</span> <span class="va">var_cols</span>, <span class="co"># Colours for the pie-glyphs</span></span>
<span>  pie_radius <span class="op">=</span> <span class="fl">0.35</span>       <span class="co"># Radius of pie-glyphs</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Predicted yield"</span>, fill <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/effect-plot-1.png" alt="Output from visualise_effects_plot() function" width="1152" style="display: block; margin: auto;"></p>
<p>The average effect of increasing the proportion of each species
follows a quadratic curve (solid black line). The average effect of
increasing the sown proportion of G1 is stronger compared to the all
other species. The other species have similar performance as their sown
proportion is increased. Moreover, increasing the sown proportion of any
species besides G1 over 50% results in a sharp decline in the predicted
yield.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rishabh Vishwakarma, Caroline Brophy, Laura Byrne, Catherine Hurley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
