<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DImodelsVis">
<title>Using DImodelsVis with regression models not fit using the DImodels package • DImodelsVis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using DImodelsVis with regression models not fit using the DImodels package">
<meta property="og:description" content="DImodelsVis">
<meta property="og:image" content="https://rishvish.github.io/DImodelsVis/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DImodelsVis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/DImodelsVis-with-complex-models.html">Using DImodelsVis with regression models not fit using the DImodels package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using DImodelsVis with regression models not fit using the DImodels package</h1>
            
      
      
      <div class="d-none name"><code>DImodelsVis-with-complex-models.Rmd</code></div>
    </div>

    
    
<p>The <code>DImodelsVis</code> is very convenient to use with
regression models fit using the <a href="https://cran.r-project.org/package=DImodels" class="external-link"><code>DImodels</code></a>
R package. However, sometimes users could have more complicated models
which couldn’t be fit using <a href="https://cran.r-project.org/package=DImodels" class="external-link"><code>DImodels</code></a>
or they would prefer to have more flexibility and control in customising
the plot or the underlying data.</p>
<p>For these situations, each plotting function has a corresponding data
preparation and plotting function. The data preparation functions have
an _data suffix while the plotting functions have an _plot suffix. This
document describes how to use the data preparation functions to
construct (and customise) the underlying data, which can then be passed
to the plotting function for visualising the results.</p>
<div class="section level3">
<h3 id="load-libraries">Load libraries<a class="anchor" aria-label="anchor" href="#load-libraries"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rishvish.github.io/DImodelsVis/">DImodelsVis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DImodels</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>We use the <code>sim4</code> data from the <a href="https://cran.r-project.org/package=DImodels" class="external-link"><code>DImodels</code></a>
R package. This is a simulated dataset to represent typical data arising
from a grassland experiment. We have several communities with one up to
six species (<code>p1</code>-<code>p6</code>) sown at varying
proportions. There is a <code>treatment</code> covariate representing
the fertilisation level (in kg/ha/yr) applied in each community.
Further, it is assumed that the species can be grouped based on the
function they perform in the community, thus <code>p1</code> and
<code>p2</code> are assumed to be grasses, with <code>p3</code> and
<code>p4</code> being legumes, and <code>p5</code> and <code>p6</code>
being herbs. The <code>response</code> variable is assumed to be annual
aboveground dry-matter yield.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sim4"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   richness treatment p1 p2 p3 p4 p5 p6 response</span></span>
<span><span class="co">#&gt; 1        1        50  1  0  0  0  0  0   26.325</span></span>
<span><span class="co">#&gt; 2        1        50  1  0  0  0  0  0   29.083</span></span>
<span><span class="co">#&gt; 3        1        50  1  0  0  0  0  0   27.581</span></span>
<span><span class="co">#&gt; 4        1        50  0  1  0  0  0  0   17.391</span></span>
<span><span class="co">#&gt; 5        1        50  0  1  0  0  0  0   15.678</span></span>
<span><span class="co">#&gt; 6        1        50  0  1  0  0  0  0   14.283</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>We take a subset of the data with communities receiving 50 and 150 kg
fertiliser and fit an <code>lm</code> model to this data where we model
the response as a linear combination of the species proportions, the
average interaction term (AV; see <code><a href="https://rdrr.io/pkg/DImodels/man/DI_data_manipulation.html" class="external-link">?DI_data_E_AV</a></code> for more
interaction) and the fertiliser treatment. We also add an interaction
between the average interaction term and fertiliser treatment, assuming
that the amount of fertiliser in a plot affects the way species
interact.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span>, <span class="st">"p3"</span>, <span class="st">"p4"</span>, <span class="st">"p5"</span>, <span class="st">"p6"</span><span class="op">)</span></span>
<span><span class="va">FG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gr"</span>, <span class="st">"Gr"</span>, <span class="st">"Le"</span>, <span class="st">"Le"</span>, <span class="st">"He"</span>, <span class="st">"He"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_data</span> <span class="op">&lt;-</span> <span class="va">sim4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DImodels/man/DI_data_manipulation.html" class="external-link">DI_data_E_AV</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">$</span><span class="va">AV</span>,</span>
<span>         treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span>  <span class="fl">0</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span> <span class="op">+</span> <span class="va">p6</span> <span class="op">+</span> <span class="op">(</span><span class="va">AV</span><span class="op">)</span><span class="op">:</span><span class="va">treatment</span>,</span>
<span>           data <span class="op">=</span> <span class="va">model_data</span><span class="op">)</span></span></code></pre></div>
<p>The model coefficients are as follows. Note: We have dropped the
intercept from this model due to the compositional nature of the
variables in the model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = response ~ 0 + p1 + p2 + p3 + p4 + p5 + p6 + (AV):treatment, </span></span>
<span><span class="co">#&gt;     data = model_data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -6.292 -2.005 -0.220  1.901  7.286 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; p1               30.2319     0.8397  36.003  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p2               20.2040     0.8397  24.061  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p3               22.1378     0.8397  26.364  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p4               23.8764     0.8397  28.435  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p5               13.5990     0.8397  16.195  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p6               15.6690     0.8397  18.660  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; AV:treatment50   11.4637     2.1505   5.331 4.11e-07 ***</span></span>
<span><span class="co">#&gt; AV:treatment150  22.9882     2.1505  10.690  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; AV:treatment250  30.3752     2.1505  14.125  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.934 on 132 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.9879, Adjusted R-squared:  0.987 </span></span>
<span><span class="co">#&gt; F-statistic:  1193 on 9 and 132 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>We proceed with this model and create visualisations for interpreting
the results.</p>
</div>
<div class="section level3">
<h3 id="model-diagnostics-plot">Model diagnostics plot<a class="anchor" aria-label="anchor" href="#model-diagnostics-plot"></a>
</h3>
<p>We first use the <code>model_diagnostics</code> function to check if
all the underlying model assumptions are satisfied.</p>
<p>The only difference here is that in addition to the model object we
also need to specify the <code>prop</code> parameter describing the name
of the compositional variables in the model where <code>species</code>
is a previously defined vector naming the six columns in the datast that
contain the species proportions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create model diagnostics plot with pie-glyphs showing species proportions</span></span>
<span><span class="fu"><a href="../reference/model_diagnostics.html">model_diagnostics</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, prop <span class="op">=</span> <span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/diagnostics-plot-1.png" width="864"></p>
<p>These plots indicate that model assumptions aren’t violated.
Overlaying with pie-glyphs has the additional benefit that we can
quickly identify the communities with unusual values. For example, the
monocultures (communities with only one species) have a very high
leverage value as seen in the <code>Residuals vs Leverage</code>
plot.</p>
</div>
<div class="section level3">
<h3 id="prediction-contributions-plot">Prediction contributions plot<a class="anchor" aria-label="anchor" href="#prediction-contributions-plot"></a>
</h3>
<p>We manually call the <code>prediction_contributions_data</code>
function to prepare the data for visualising the contributions of the
various terms in the regression model to the predicted response.</p>
<p>We use a subset of the original data consisting of the six
monocultures and the equi-proportional community at the 50 kg
fertilisation treatment.</p>
<p><i>Note: It is important for the specified <code>data</code> to have
all the variables in the model. An error will be thrown if any variable
is missing.</i></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_data</span> <span class="op">&lt;-</span> <span class="va">model_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">10</span>, <span class="fl">13</span>, <span class="fl">16</span>, <span class="fl">45</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">subset_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    richness treatment        p1        p2        p3        p4        p5</span></span>
<span><span class="co">#&gt; 1         1        50 1.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; 4         1        50 0.0000000 1.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; 7         1        50 0.0000000 0.0000000 1.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; 10        1        50 0.0000000 0.0000000 0.0000000 1.0000000 0.0000000</span></span>
<span><span class="co">#&gt; 13        1        50 0.0000000 0.0000000 0.0000000 0.0000000 1.0000000</span></span>
<span><span class="co">#&gt; 16        1        50 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; 45        6        50 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667</span></span>
<span><span class="co">#&gt;           p6 response        AV</span></span>
<span><span class="co">#&gt; 1  0.0000000   26.325 0.0000000</span></span>
<span><span class="co">#&gt; 4  0.0000000   17.391 0.0000000</span></span>
<span><span class="co">#&gt; 7  0.0000000   16.317 0.0000000</span></span>
<span><span class="co">#&gt; 10 0.0000000   25.768 0.0000000</span></span>
<span><span class="co">#&gt; 13 0.0000000   12.330 0.0000000</span></span>
<span><span class="co">#&gt; 16 1.0000000    9.965 0.0000000</span></span>
<span><span class="co">#&gt; 45 0.1666667   25.118 0.4166667</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prediction_contributions_data.html">prediction_contributions_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">subset_data</span>,</span>
<span>                                           model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="va">plot_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 49 × 10</span></span></span>
<span><span class="co">#&gt;    .Community richness treatment response    AV .Pred .Lower .Upper</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1                 1 50            26.3     0  30.2   28.6   31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1                 1 50            26.3     0  30.2   28.6   31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1                 1 50            26.3     0  30.2   28.6   31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1                 1 50            26.3     0  30.2   28.6   31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1                 1 50            26.3     0  30.2   28.6   31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1                 1 50            26.3     0  30.2   28.6   31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1                 1 50            26.3     0  30.2   28.6   31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 4                 1 50            17.4     0  20.2   18.5   21.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 4                 1 50            17.4     0  20.2   18.5   21.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4                 1 50            17.4     0  20.2   18.5   21.9</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 39 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: .Contributions &lt;chr&gt;, .Value &lt;dbl&gt;</span></span></span></code></pre></div>
<p><code>subset_data</code> is expanded to include the model predictions
(<code>.Pred</code>) along with the associated uncertainty
(<code>.Lower</code> and <code>.Upper</code>). We also have a column
labelled <code>.Contributions</code> identifying the names of all
variables in the model along their values in <code>.Value</code>.</p>
<p>A benefit of using the data preparation functions is that, it’s also
possible to create the data using model coefficients. This is
particularly useful for cases when your statistical model is fit using a
different software (SAS, SPSS, etc.) and it’s difficult to fit the same
model in R. We could simply import the coefficients from the external
model and use those to create our visualisations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span> <span class="op">=</span> <span class="fl">30.23</span>, <span class="st">"p2"</span> <span class="op">=</span> <span class="fl">20.20</span>, <span class="st">"p3"</span> <span class="op">=</span> <span class="fl">22.13</span>,</span>
<span>            <span class="st">"p4"</span> <span class="op">=</span> <span class="fl">23.88</span>, <span class="st">"p5"</span> <span class="op">=</span> <span class="fl">13.60</span>, <span class="st">"p6"</span> <span class="op">=</span> <span class="fl">15.67</span>,</span>
<span>            <span class="st">"AV:treatment50"</span> <span class="op">=</span> <span class="fl">11.46</span>,</span>
<span>            <span class="st">"AV:treatment150"</span> <span class="op">=</span> <span class="fl">22.99</span>,</span>
<span>            <span class="st">"AV:treatment250"</span> <span class="op">=</span> <span class="fl">30.37</span><span class="op">)</span></span>
<span><span class="co"># One could also export the variance-covariance matrix from another </span></span>
<span><span class="co"># software as a .csv file and read it here using the read.csv() function</span></span>
<span><span class="va">vcov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">)</span></span>
<span><span class="co">#&gt;              p1              p2              p3              p4              p5 </span></span>
<span><span class="co">#&gt;           30.23           20.20           22.13           23.88           13.60 </span></span>
<span><span class="co">#&gt;              p6  AV:treatment50 AV:treatment150 AV:treatment250 </span></span>
<span><span class="co">#&gt;           15.67           11.46           22.99           30.37</span></span>
<span></span>
<span><span class="co"># Note when using model-coefficients, the data should be in the same order </span></span>
<span><span class="co"># as the model coefficients</span></span>
<span><span class="co"># We can use the model.matrix function to prepare our subset data in the necessary format</span></span>
<span><span class="va">coeff_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span> <span class="op">+</span> <span class="va">p6</span> <span class="op">+</span> <span class="va">AV</span><span class="op">:</span><span class="va">treatment</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">subset_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">coeff_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;           p1        p2        p3        p4        p5        p6 AV:treatment50</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000      0.0000000</span></span>
<span><span class="co">#&gt; 4  0.0000000 1.0000000 0.0000000 0.0000000 0.0000000 0.0000000      0.0000000</span></span>
<span><span class="co">#&gt; 7  0.0000000 0.0000000 1.0000000 0.0000000 0.0000000 0.0000000      0.0000000</span></span>
<span><span class="co">#&gt; 10 0.0000000 0.0000000 0.0000000 1.0000000 0.0000000 0.0000000      0.0000000</span></span>
<span><span class="co">#&gt; 13 0.0000000 0.0000000 0.0000000 0.0000000 1.0000000 0.0000000      0.0000000</span></span>
<span><span class="co">#&gt; 16 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 1.0000000      0.0000000</span></span>
<span><span class="co">#&gt; 45 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667      0.4166667</span></span>
<span><span class="co">#&gt;    AV:treatment150 AV:treatment250</span></span>
<span><span class="co">#&gt; 1                0               0</span></span>
<span><span class="co">#&gt; 4                0               0</span></span>
<span><span class="co">#&gt; 7                0               0</span></span>
<span><span class="co">#&gt; 10               0               0</span></span>
<span><span class="co">#&gt; 13               0               0</span></span>
<span><span class="co">#&gt; 16               0               0</span></span>
<span><span class="co">#&gt; 45               0               0</span></span>
<span></span>
<span><span class="co"># Notice how the column names of the coefficients and coeff_data match exactly</span></span>
<span></span>
<span><span class="co"># Use coefficients and vcov parameter to specify the coefficients and </span></span>
<span><span class="co"># variance-covariance matrix respectively.</span></span>
<span><span class="co"># Note: specifing a vcov matrix is necessary only if the user want the </span></span>
<span><span class="co"># uncertainty associated with the prediction</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prediction_contributions_data.html">prediction_contributions_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coeff_data</span>,</span>
<span>                                           coefficients <span class="op">=</span> <span class="va">coeffs</span>,</span>
<span>                                           vcov <span class="op">=</span> <span class="va">vcov_mat</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   .Community .Pred .Lower .Upper .Contributions .Value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           30.2   28.6   31.9 p1               30.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1           30.2   28.6   31.9 p2                0  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1           30.2   28.6   31.9 p3                0  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1           30.2   28.6   31.9 p4                0  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1           30.2   28.6   31.9 p5                0  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1           30.2   28.6   31.9 p6                0</span></span></code></pre></div>
<p>This data can then be passed to the
<code>prediction_contributions_plot</code> function to visualise the
results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prediction_contributions_plot.html">prediction_contributions_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/prediction-contributions-plot-1.png" width="768"></p>
<p>The predicted response is highest for the <code>p1</code>
monoculture. The centroid community also has a high prediction with the
highest contribution coming from <code>p1</code> and the average
interaction term.</p>
</div>
<div class="section level3">
<h3 id="average-change-over-diversity-gradient">Average change over diversity gradient<a class="anchor" aria-label="anchor" href="#average-change-over-diversity-gradient"></a>
</h3>
<p>We can use the <code>gradient_change_data</code> function to prepare
data for visualising the average change in the predicted response over a
diversity gradient. The resultant data would have the
<code>.Richness</code> and <code>.Evenness</code> gradient values,
<code>.Gradient</code> would have the name of the gradient chosen the
calculate the average, <code>.Pred</code> has the predicted response
while <code>.Avg</code> would have the average predicted response at
each level of chosen diversity gradient.</p>
<p><i> Note: The calculated average is the mean of the communities
specified in the data and not the average of all possible
communities.</i></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gradient_change_data.html">gradient_change_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">model_data</span>, prop <span class="op">=</span> <span class="va">species</span>,</span>
<span>                                  model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 15</span></span></span>
<span><span class="co">#&gt;   richness treatment    p1    p2    p3    p4    p5    p6 response    AV</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1 50            1     0     0     0     0     0     26.3     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        1 50            1     0     0     0     0     0     29.1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        1 50            1     0     0     0     0     0     27.6     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        1 50            0     1     0     0     0     0     17.4     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        1 50            0     1     0     0     0     0     15.7     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        1 50            0     1     0     0     0     0     14.3     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: .Richness &lt;dbl&gt;, .Evenness &lt;dbl&gt;, .Gradient &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   .Pred &lt;dbl&gt;, .Avg &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The output data can be passed to <code>gradient_change_plot</code> to
visualise the results. We use the <code>facet_var</code> parameter and
specify <code>"treatment"</code> to create a separate panel for each
treatment.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gradient_change_plot.html">gradient_change_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span>, </span>
<span>                     facet_var <span class="op">=</span> <span class="st">"treatment"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/gradient-change-plot-1.png" width="768"></p>
<p>As the richness increases, the predicted response increases but at a
saturating rate. The average predicted response also increases as we
increase the rate of fertilisation.</p>
</div>
<div class="section level3">
<h3 id="effects-plot-for-compositional-data">Effects plot for compositional data<a class="anchor" aria-label="anchor" href="#effects-plot-for-compositional-data"></a>
</h3>
<p>The <code>visualise_effect_data</code> function can be used to create
the data showing the change in the response as we increase/decrease the
proportion of one of the variables in the data. Due to the compositional
nature of the variables, changing the proportion of any one affects the
proportion of all other variables. The function handles this by ensuring
that as the proportion of any variable changes, all remaining variables
are adjusted to ensure their relative proportion always stays
constant.</p>
<p>We use the <code>subset_data</code> from before containing the six
monocultures and six-species centroid community and see the effect of
increasing the proportion of the species <code>p1</code> and
<code>p3</code> (specified using <code>var_interest</code>) in these
communities.</p>
<p><i> Note: Since the species interaction term depends on the
proportions of the species, we use <code>prediction = FALSE</code> to
create the template of species proportion first and then add the
interaction structure.</i></p>
<p>Further, we manually call the <code>add_prediction</code> function to
add the predictions to the resultant data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualise_effects_data.html">visualise_effects_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">subset_data</span>, prop <span class="op">=</span> <span class="va">species</span>,</span>
<span>                                    var_interest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p3"</span><span class="op">)</span>,</span>
<span>                                    effect <span class="op">=</span> <span class="st">"increase"</span>,</span>
<span>                                    prediction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DImodels/man/DI_data_manipulation.html" class="external-link">DI_data_E_AV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, </span>
<span>                                                    prop <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">$</span><span class="va">AV</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span><span class="va">plot_data</span>, model <span class="op">=</span> <span class="va">mod</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span></code></pre></div>
<p>The data is expanded to include the following columns</p>
<ul>
<li>
<code>.Sp</code>: The variable of interest who’s proportion is
changed.</li>
<li>
<code>.Proportion</code>: The proportion of the variable of interest
in a community.</li>
<li>
<code>.Group</code>: An identifier for creating the
<code>effects</code> curve.</li>
<li>
<code>.Effect</code>: A string describing whether the proportion of
the variable of interest is increased or decreased.</li>
<li>
<code>.Pred</code>: The predicted response for a community.</li>
<li>
<code>.Lower</code>: The lower interval (at <span class="math inline">\(% confidence level = 0.95\)</span> level) for the
predicted response.</li>
<li>
<code>.Upper</code>: The upper interval (at <span class="math inline">\(% confidence level = 0.95\)</span> level) for the
predicted response.</li>
</ul>
<p>Passing this data to <code>visualise_effects_plot</code> function
results in the following plot.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualise_effects_plot.html">visualise_effects_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/visualise-effects-plot-1.png" width="768"></p>
<p>Increasing the proportion of <code>p1</code> always results in an
increase in the predicted response while increasing the proportion of
<code>p3</code> could increase or decrease the predicted response
depending on the proportion of the other species in the community.</p>
</div>
<div class="section level3">
<h3 id="change-in-response-across-the-simplex-space">Change in response across the simplex space<a class="anchor" aria-label="anchor" href="#change-in-response-across-the-simplex-space"></a>
</h3>
<p>This function is a more general version of effects plots and helps to
visualise the change in the response as we move in a straight line
between two points across the simplex space. Mathematically, this is
equivalent to changing the proportion of multiple compositional
variables whilst keeping the ratio of the remaining variables
constant.</p>
<p>To use <code>simplex_path_data</code> we should specify a data-frame
consisting of starting and ending communities. In this example, we
specify the six-species centroid mixture as our starting community and
see the change in the response as we move towards the monoculture of
each of the six species across all three fertiliser treatments.</p>
<p><i> Note: Just like <code>effect_plot_data</code>, we use
<code>prediction = FALSE</code> to create the template of species
proportion first and then add the interaction structure, followed by a
call to the <code>add_prediction</code> function to add the predictions
to the resultant data.</i></p>
<p>The data is expanded to include the following columns *
<code>.InterpConst</code>: The interpolation constant between the start
and end points (will be between 0 and 1). * <code>.Group</code>: An
identifier for creating the <code>effects</code> curve. *
<code>.Pred</code>: The predicted response for a community. *
<code>.Lower</code>: The lower interval (at <span class="math inline">\(\alpha = 0.05\)</span> level) for the predicted
response. * <code>.Upper</code>: The upper interval (at <span class="math inline">\(\alpha = 0.05\)</span> level) for the predicted
response.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_comm</span> <span class="op">&lt;-</span> <span class="va">model_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">richness</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">treatment</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">end_comm</span> <span class="op">&lt;-</span> <span class="va">model_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">richness</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, <span class="va">p5</span>, <span class="va">p6</span>, <span class="va">treatment</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simplex_path_data.html">simplex_path_data</a></span><span class="op">(</span>starts <span class="op">=</span> <span class="va">start_comm</span>,</span>
<span>                               ends <span class="op">=</span> <span class="va">end_comm</span>,</span>
<span>                               prop <span class="op">=</span> <span class="va">species</span>,</span>
<span>                               prediction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DImodels/man/DI_data_manipulation.html" class="external-link">DI_data_E_AV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, </span>
<span>                                                    prop <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">$</span><span class="va">AV</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span><span class="va">plot_data</span>, model <span class="op">=</span> <span class="va">mod</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;          p1        p2        p3        p4        p5        p6 richness</span></span>
<span><span class="co">#&gt; 1 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667        6</span></span>
<span><span class="co">#&gt; 2 0.1750000 0.1650000 0.1650000 0.1650000 0.1650000 0.1650000        6</span></span>
<span><span class="co">#&gt; 3 0.1833333 0.1633333 0.1633333 0.1633333 0.1633333 0.1633333        6</span></span>
<span><span class="co">#&gt; 4 0.1916667 0.1616667 0.1616667 0.1616667 0.1616667 0.1616667        6</span></span>
<span><span class="co">#&gt; 5 0.2000000 0.1600000 0.1600000 0.1600000 0.1600000 0.1600000        6</span></span>
<span><span class="co">#&gt; 6 0.2083333 0.1583333 0.1583333 0.1583333 0.1583333 0.1583333        6</span></span>
<span><span class="co">#&gt;   treatment response        AV .InterpConst .Group    .Pred   .Lower   .Upper</span></span>
<span><span class="co">#&gt; 1        50   25.118 0.4166667         0.00      1 25.72958 24.25535 27.20380</span></span>
<span><span class="co">#&gt; 2        50   25.118 0.4166250         0.01      1 25.82189 24.34775 27.29602</span></span>
<span><span class="co">#&gt; 3        50   25.118 0.4165000         0.02      1 25.91324 24.43936 27.38712</span></span>
<span><span class="co">#&gt; 4        50   25.118 0.4162917         0.03      1 26.00364 24.53020 27.47709</span></span>
<span><span class="co">#&gt; 5        50   25.118 0.4160000         0.04      1 26.09309 24.62025 27.56593</span></span>
<span><span class="co">#&gt; 6        50   25.118 0.4156250         0.05      1 26.18158 24.70952 27.65364</span></span></code></pre></div>
<p>This data is passed to the <code>simplex_path_plot</code> function to
create the data for creating the plot. We use <code>facet_var</code> to
show a separate panel for each treatment and also show the uncertainty
around the prediction using <code>se = TRUE</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/simplex_path_plot.html">simplex_path_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span>, se <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  facet_var <span class="op">=</span> <span class="st">"treatment"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created plot.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/simplex-path-plot-1.png" width="768">
At <code>"50"</code> kg and <code>"150"</code> kg of fertiliser
treatment, increasing the proportion of <code>p1</code> results in a
higher predicted response, while increasing the proportion of other
species decreases the predicted response. At <code>"250"</code> kg of
fertilisation all monocultures perform worse than the centroid community
and thus increasing their proportion decreases the response.</p>
</div>
<div class="section level3">
<h3 id="conditional-ternary-plot">Conditional ternary plot<a class="anchor" aria-label="anchor" href="#conditional-ternary-plot"></a>
</h3>
<p>We fix <code>n-3</code> variables to have a constant value <span class="math inline">\(p_1, p_2, p_3, ..., p_{n-3}\)</span> such that
<span class="math inline">\(P = p_1 + p_2 + p_3 + ... p_{n - 3}\)</span>
and <span class="math inline">\(0 \leq P \leq 1\)</span> and vary the
proportion of the remaining three variables between <span class="math inline">\(0\)</span> and <span class="math inline">\(1-P\)</span> to visualise the change in the
predicted response as a contour map within a ternary diagram.</p>
<p>In this example we create two ternary diagrams showing the effect of
changing the proportion of species <code>p1</code>, <code>p5</code> and
<code>p6</code>; One where <code>p2 = 0</code> and <code>p3 = 0.3</code>
and second with <code>p2 = 0.2</code> and <code>p3 = 0.3</code>. Any
compositional variables not specified would be assumed to be 0 (thus
<code>p4 = 0</code> in both diagrams).</p>
<p>We also use the <code>add_var</code> parameter to specify that the
treatment value should be <code>"50"</code> and <code>"250"</code> for
the plots. This could ignored and we could add the treatment value after
creating the template, but the benefit of using <code>add_var</code> is
that it adds an identifier to the data which is used to automatically
create a separate panel for each value of treatment.</p>
<p>Since the interaction term is dependent on the species proportions,
we use <code>prediction = FALSE</code> to create the template of
proportions first, then add the interaction term. Finally, the
<code>add_prediction</code> function is called to add the predictions to
the data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conditional_ternary_data.html">conditional_ternary_data</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">species</span>, </span>
<span>                                      tern_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p5"</span>, <span class="st">"p6"</span><span class="op">)</span>,</span>
<span>                                      add_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"treatment"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"50"</span>, <span class="st">"250"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                      conditional <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"p2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, </span>
<span>                                                               <span class="st">"p3"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                      prediction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DImodels/man/DI_data_manipulation.html" class="external-link">DI_data_E_AV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, </span>
<span>                                                    prop <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">$</span><span class="va">AV</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span><span class="va">plot_data</span>, model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   p1        p5          p6          .x .y p2  p3 treatment   .add_str_ID p4</span></span>
<span><span class="co">#&gt; 1  0 0.8000000 0.000000000 0.000000000  0  0 0.2        50 treatment: 50  0</span></span>
<span><span class="co">#&gt; 2  0 0.7986644 0.001335559 0.001669449  0  0 0.2        50 treatment: 50  0</span></span>
<span><span class="co">#&gt; 3  0 0.7973289 0.002671119 0.003338898  0  0 0.2        50 treatment: 50  0</span></span>
<span><span class="co">#&gt; 4  0 0.7959933 0.004006678 0.005008347  0  0 0.2        50 treatment: 50  0</span></span>
<span><span class="co">#&gt; 5  0 0.7946578 0.005342237 0.006677796  0  0 0.2        50 treatment: 50  0</span></span>
<span><span class="co">#&gt; 6  0 0.7933222 0.006677796 0.008347245  0  0 0.2        50 treatment: 50  0</span></span>
<span><span class="co">#&gt;      .Sp .Value           .Facet        AV    .Pred</span></span>
<span><span class="co">#&gt; 1 p2, p3 0, 0.2 p2 = 0; p3 = 0.2 0.1600000 17.14093</span></span>
<span><span class="co">#&gt; 2 p2, p3 0, 0.2 p2 = 0; p3 = 0.2 0.1610667 17.15593</span></span>
<span><span class="co">#&gt; 3 p2, p3 0, 0.2 p2 = 0; p3 = 0.2 0.1621298 17.17088</span></span>
<span><span class="co">#&gt; 4 p2, p3 0, 0.2 p2 = 0; p3 = 0.2 0.1631893 17.18579</span></span>
<span><span class="co">#&gt; 5 p2, p3 0, 0.2 p2 = 0; p3 = 0.2 0.1642453 17.20066</span></span>
<span><span class="co">#&gt; 6 p2, p3 0, 0.2 p2 = 0; p3 = 0.2 0.1652976 17.21549</span></span></code></pre></div>
<p>We pass this data to the <code>conditional_ternary_plot</code>
function to create the plot. We specify <code>nrow = 2</code> to arrange
the plots for the two treatments in two rows.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/conditional_ternary_plot.html">conditional_ternary_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/conditional-ternary-plot-1.png" width="768">
The predicted response is maximised as we increase the proportion of
<code>p1</code> and a higher fertilisation results in higher predicted
response.</p>
</div>
<div class="section level3">
<h3 id="grouped-ternary-plot">Grouped ternary plot<a class="anchor" aria-label="anchor" href="#grouped-ternary-plot"></a>
</h3>
<p>Sometimes, the compositional variables could be combined and grouped
to reduce the number of variables. In this data the species
<code>p1</code> and <code>p2</code> are assumed to be grasses,
<code>p3</code> and <code>p4</code> are legumes, and <code>p5</code> and
<code>p6</code> are herbs, thus we could combine these species to have
three (grasses, legumes and herbs) compositional variables instead of
six.</p>
<p>Using the <code>grouped_ternary_data</code> function we can visualise
the change in the response as we change the proportion of grasses,
legume, and herbs. The species are specified using the <code>prop</code>
argument, while the group each species belongs to is specified using
<code>FG</code>. There is a one-to-one mapping between <code>prop</code>
and <code>FG</code>, thus for example <code>p1</code> and
<code>p2</code> belong to the group <code>"Gr"</code>. There is also
flexibility to adjust the proportion of the species within the
functional group as well using the <code>values</code> parameter. In
this example, each species within a group is 50% of the total group
proportion. All other parameters are same as
<code>conditional_ternary_data</code>. See
<code><a href="../reference/grouped_ternary_data.html">?grouped_ternary_data</a></code> for more information.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grouped_ternary_data.html">grouped_ternary_data</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>, <span class="st">"p2"</span>, <span class="st">"p3"</span>, <span class="st">"p4"</span>, <span class="st">"p5"</span>, <span class="st">"p6"</span><span class="op">)</span>, </span>
<span>                                  FG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gr"</span>, <span class="st">"Gr"</span>, <span class="st">"Le"</span>, <span class="st">"Le"</span>, <span class="st">"He"</span>, <span class="st">"He"</span><span class="op">)</span>,</span>
<span>                                  values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                                  add_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"treatment"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"50"</span>,<span class="st">"250"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  prediction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Finished data preparation.</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DImodels/man/DI_data_manipulation.html" class="external-link">DI_data_E_AV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, </span>
<span>                                                    prop <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">$</span><span class="va">AV</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_prediction.html">add_prediction</a></span><span class="op">(</span><span class="va">plot_data</span>, model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<p>We pass this data to the <code>grouped_ternary_plot</code> function
to create the plot. We specify <code>nrow = 2</code> to arrange the
plots for the two treatments in two rows.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grouped_ternary_plot.html">grouped_ternary_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created all plots.</span></span></code></pre></div>
<p><img src="DImodelsVis-with-complex-models_files/figure-html/grouped-ternary-plot-1.png" width="576"></p>
<p>The figure shows that the predicted response is higher for the
<code>"250"</code> kg treatment across the entire simplex space and
within a given level of fertilisation the response is maximised by
increasing the proportion of grasses and legumes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rishabh Vishwakarma, Caroline Brophy, Laura Byrne, Catherine Hurley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
